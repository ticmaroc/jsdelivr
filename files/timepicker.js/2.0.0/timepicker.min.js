/**
 * A lightweight, customizable, TimePicker. Zero dependencies.
 * https://github.com/jonataswalker/timepicker.js
 * Version: v2.0.0
 * Built: 2016-04-20T22:20:15-0300
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.TimePicker=t()}(this,function(){"use strict";var e={open:"open",close:"close",change:"change",start_fade_in:"start-fade-in",end_fade_in:"end-fade-in",start_fade_out:"start-fade-out",end_fade_out:"end-fade-out"},t={lang:"en",theme:"dark"},n={en:{hour:"Hour",minute:"Minute"},pt:{hour:"Hora",minute:"Minuto"}},i={focusable:/^(?:input|select|textarea|button|object)$/i,clickable:/^(?:a|area)$/i,classRegex:function(e){return new RegExp("(^|\\s+) "+e+" (\\s+|$)")},addClass:function(e,t,n){var i=this;if(Array.isArray(e))return void e.forEach(function(e){i.addClass(e,t)});for(var s=Array.isArray(t)?t:t.split(/\s+/),o=s.length;o--;)i.hasClass(e,s[o])||i._addClass(e,s[o],n)},_addClass:function(e,t,n){var i=this;e.classList?e.classList.add(t):e.className=(e.className+" "+t).trim(),n&&this.isNumeric(n)&&window.setTimeout(function(){i._removeClass(e,t)},n)},removeClass:function(e,t,n){var i=this;if(Array.isArray(e))return void e.forEach(function(e){i.removeClass(e,t,n)});for(var s=Array.isArray(t)?t:t.split(/\s+/),o=s.length;o--;)i.hasClass(e,s[o])&&i._removeClass(e,s[o],n)},_removeClass:function(e,t,n){var i=this;e.classList?e.classList.remove(t):e.className=e.className.replace(this.classRegex(t)," ").trim(),n&&this.isNumeric(n)&&window.setTimeout(function(){i._addClass(e,t)},n)},hasClass:function(e,t){return e.classList?e.classList.contains(t):this.classRegex(t).test(e.className)},toggleClass:function(e,t){var n=this;return Array.isArray(e)?void e.forEach(function(e){n.toggleClass(e,t)}):void(e.classList?e.classList.toggle(t):this.hasClass(e,t)?this._removeClass(e,t):this._addClass(e,t))},$:function(e){return e="#"===e[0]?e.substr(1,e.length):e,document.getElementById(e)},isElement:function(e){return"HTMLElement"in window?!!e&&e instanceof HTMLElement:!!e&&"object"==typeof e&&1===e.nodeType&&!!e.nodeName},getAllChildren:function(e,t){return[].slice.call(e.getElementsByTagName(t))},getMaxZIndex:function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=-1);for(var i=this.find("*",document,!0),s=i.length;++n<s;)e=parseInt(window.getComputedStyle(i[n]).zIndex,10),t=e?Math.max(t,e):t;return t},mergeOptions:function(e,t){var n={};for(var i in e)n[i]=e[i];for(var s in t)n[s]=t[s];return n},createElement:function(e,t){var n;if(Array.isArray(e)){if(n=document.createElement(e[0]),e[1].id&&(n.id=e[1].id),e[1].classname&&(n.className=e[1].classname),e[1].attr){var i=e[1].attr;if(Array.isArray(i))for(var s=-1;++s<i.length;)n.setAttribute(i[s].name,i[s].value);else n.setAttribute(i.name,i.value)}}else n=document.createElement(e);n.innerHTML=t;for(var o=document.createDocumentFragment();n.childNodes[0];)o.appendChild(n.childNodes[0]);return n.appendChild(o),n},find:function(e,t,n){var i=/^(#?[\w-]+|\.[\w-.]+)$/,s=/\./g,o=[].slice,r=[];if(i.test(e))switch(e[0]){case"#":r=[this.$(e.substr(1))];break;case".":r=o.call(t.getElementsByClassName(e.substr(1).replace(s," ")));break;default:r=o.call(t.getElementsByTagName(e))}else r=o.call(t.querySelectorAll(e));return n?r:r[0]},offset:function(e){var t=e.getBoundingClientRect(),n=document.documentElement;return{left:t.left+window.pageXOffset-n.clientLeft,top:t.top+window.pageYOffset-n.clientTop,width:e.offsetWidth,height:e.offsetHeight}},getWindowSize:function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}},evaluate:function(e){var t;switch(this.toType(e)){case"window":case"htmldocument":case"element":t=e;break;case"string":t=this.$(e)}return this.assert(t,"Can't evaluate: @param "+e),t},toType:function(e){return e==window&&e.document&&e.location?"window":e==document?"htmldocument":"string"==typeof e?"string":this.isElement(e)?"element":void 0},typeOf:function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},events:function(){var e={},t=e.hasOwnProperty;return{subscribe:function(n,i){t.call(e,n)||(e[n]=[]);var s=e[n].push(i)-1;return{remove:function(){delete e[n][s]}}},publish:function(n,i){t.call(e,n)&&e[n].forEach(function(e){e(void 0!==i?i:{})})}}},fade:function(t,n,i,s){void 0===i&&(i=300),void 0===s&&(s="in");var o,r,a=null,l=!1,c="in"==s?e.start_fade_in:e.start_fade_out,u="in"==s?e.end_fade_in:e.end_fade_out,d=function(e){a||(t.publish(c,{target:n}),a=e),"in"==s?(o=+n.style.opacity+(e-a)/i,l=o>=1):(o=+n.style.opacity-(e-a)/i,l=0>=o),n.style.opacity=o,l?t.publish(u,{target:n}):r=window.requestAnimationFrame(d)};return r=window.requestAnimationFrame(d)},assert:function(e,t){if(!e){if(t=t||"Assertion failed","undefined"!=typeof Error)throw new Error(t);throw t}}},s="_jw-tpk",o="-container",r="-header",a="-body",l="-hour",c="-minute",u="-selected",d="-dragging",h={hour:"data-hour",minute:"data-minute"},f={hour_list:"hour_list_id",minute_list:"minute_list_id"},m=function(e){this.Base=e};m.prototype.createPicker=function(){for(var e,t,a=this.Base.options,l=m.picker.indexOf(m.replace.hour_list),c=m.picker.indexOf(m.replace.minute_list),u=m.picker.indexOf(m.replace.hour_title),d=m.picker.indexOf(m.replace.minute_title),f=[],p=[],v=0,g=6,y=0;4>y;y++){for(t=v+g,f.push("<ol>");t>v;v++)f.push(["<li><a ",h.hour,'="',v,'">',v,"</a></li>"].join(""));f.push("</ol>")}for(v=0,t=0,g=15,y=0;4>y;y++){for(t=v+g,p.push("<ol>");t>v;v+=5)e=10>v?e="0"+v:v,p.push(["<li><a ",h.minute,'="',e,'">',e,"</a></li>"].join(""));p.push("</ol>")}m.picker[l]=f.join(""),m.picker[c]=p.join(""),m.picker[u]=n[a.lang].hour,m.picker[d]=n[a.lang].minute;var _=i.createElement(["div",{classname:s+o+" "+s+"-"+a.theme}],m.picker.join(""));_.style.zIndex=i.getMaxZIndex()+10,_.style.visibility="hidden",document.body.appendChild(_);var w=i.offset(_);return this.Base.container={size:{width:w.width,height:w.height},element:_,drag_handle:_.querySelector("."+(s+r))},_.style.visibility="",_.style.display="none",_},m.replace={hour_list:"__hour-list__",minute_list:"__minute-list__",hour_title:"__hour-title__",minute_title:"__minute-title__"},m.picker=['<div class="'+(s+r)+'">','<div class="'+(s+l)+'">',m.replace.hour_title,"</div>",'<div class="'+(s+c)+'">',m.replace.minute_title,"</div>","</div>",'<div class="'+(s+a)+'">','<div id="'+f.hour_list+'" class="'+(s+l)+'">',m.replace.hour_list,"</div>",'<div id="'+f.minute_list+'" class="'+(s+c)+'">',m.replace.minute_list,"</div>","</div>"];var p=function(e){var t,n,i,s,o,r,a=e.container.element,l={},c=function(e){e.preventDefault&&e.preventDefault(),i=parseInt(a.style.left,10)||0,s=parseInt(a.style.top,10)||0,o=i+(e.clientX-t),r=s+(e.clientY-n),l.move.call(void 0,{target:a,x:o,y:r}),t=e.clientX,n=e.clientY},u=function(){document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",stop,!1),l.end.call(void 0,{target:a,x:o,y:r})},d=function(e){0===e.button&&(t=e.clientX,n=e.clientY,l.start.call({target:a}),document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",u,!1))};return e.container.drag_handle.addEventListener("mousedown",d,!1),{when:function(e){l.start=e.start,l.move=e.move,l.end=e.end}}},v=function(e){this.Base=e,this.container=e.container.element,this.closeWhen={hour:!1,minute:!1},this._ids=0,this.id_active=void 0,this.opened=!1,this.targets=[],this.collection={hours:[],minutes:[]},this.events=i.events(),this.request_ani_id=void 0};v.prototype.init=function(){this.setFocusListener(this.Base.target),this.setSelectListener()},v.prototype.show=function(t){var n=this.targets[t].element,s=i.offset(n),o=this.Base.container.size,r=s.top+s.height+5,a=i.getWindowSize();s.left+o.width>a.width?(this.container.style.left="",this.container.style.right="5px"):(this.container.style.right="",this.container.style.left=s.left+"px"),s.top+o.height>a.height?this.container.style.bottom="5px":this.container.style.top=r+"px",this.events.subscribe(e.start_fade_in,function(e){e.target.style.opacity=0,e.target.style.display="block"}),this.request_ani_id=i.fade(this.events,this.container,400),this.Base.dispatchEvent(e.open,{element:n}),this.handleOpen(t)},v.prototype.hide=function(){this.opened=!1,this.events.subscribe(e.start_fade_out,function(e){e.target.style.opacity=1,e.target.style.display="block"}),this.events.subscribe(e.end_fade_out,function(e){e.target.style.display="none"}),this.request_ani_id=i.fade(this.events,this.container,800,"out"),this.Base.dispatchEvent(e.close,{element:this.targets[this.id_active].element})},v.prototype.handleOpen=function(e){var t,n=this,o=this,r=s+u,a=this.targets[e].hour,l=this.targets[e].minute;i.removeClass(this.collection.hours,r),i.removeClass(this.collection.minutes,r),a&&l&&(this.collection.hours.forEach(function(e){return t=n.getHour(e),t==a?void i.addClass(e,r):void 0}),this.collection.minutes.forEach(function(e){return t=n.getMinute(e),t==l?void i.addClass(e,r):void 0})),document.addEventListener("mousedown",{handleEvent:function(t){if(!o.container.contains(t.target)){var n=!1;o.targets.forEach(function(e){e.element==t.target&&(n=!0)}),!n&&o.opened&&o.hide(),o.targets[e].element!=t.target&&document.removeEventListener(t.type,this,!1)}}},!1),this.opened=!0,this.id_active=e,this.closeWhen={hour:!1,minute:!1}},v.prototype.handleClose=function(){this.closeWhen.hour&&this.closeWhen.minute&&this.hide()},v.prototype.getHour=function(e){return e.getAttribute(h.hour)},v.prototype.getMinute=function(e){return e.getAttribute(h.minute)},v.prototype.setSelectListener=function(){var t=this,n=i.$(f.hour_list),o=i.$(f.minute_list),r=s+u;this.collection.hours=i.getAllChildren(n,"a"),this.collection.minutes=i.getAllChildren(o,"a");var a=function(n){n.preventDefault();var s=t.targets[t.id_active];s.hour=t.getHour(n.target),t.Base.dispatchEvent(e.change,{element:s.element,hour:s.hour,minute:s.minute}),i.removeClass(t.collection.hours,r),i.addClass(n.target,r),t.closeWhen.hour=!0,t.handleClose()},l=function(n){n.preventDefault();var s=t.targets[t.id_active];s.minute=t.getMinute(n.target),t.Base.dispatchEvent(e.change,{element:s.element,hour:s.hour,minute:s.minute}),i.removeClass(t.collection.minutes,r),i.addClass(n.target,r),t.closeWhen.minute=!0,t.handleClose()};this.collection.hours.forEach(function(e){e.addEventListener("click",a)}),this.collection.minutes.forEach(function(e){e.addEventListener("click",l)})},v.prototype.setFocusListener=function(e){var t,n=this,s=function(e){e.preventDefault(),window.cancelAnimationFrame(n.request_ani_id),n.show(e.target._id)},o=[];e=Array.isArray(e)?e:[e],Array.prototype.push.apply(o,e),o.forEach(function(e){if(t=i.evaluate(e)){var o=n._ids++;t._id=o,n.targets[o]={element:t},i.focusable.test(t.nodeName)?t.addEventListener("focus",s,!0):i.clickable.test(t.nodeName)&&t.addEventListener("click",s,!0)}})};var g=function(){this._events=this._events||{},this._onceEvents=this._onceEvents||{}};g.prototype.on=function(e,t){if(e&&t){var n=this._events[e]=this._events[e]||[];return-1==n.indexOf(t)&&n.push(t),this}},g.prototype.once=function(e,t){if(e&&t){this.on(e,t);var n=this._onceEvents[e]=this._onceEvents[e]||{};return n[t]=!0,this}},g.prototype.off=function(e,t){var n=this._events&&this._events[e];if(n&&n.length){var i=n.indexOf(t);return-1!=i&&n.splice(i,1),this}},g.prototype.dispatchEvent=function(e,t){var n=this;void 0===t&&(t={});var i=this._events&&this._events[e];if(i&&i.length){for(var s=0,o=i[s],r=this._onceEvents&&this._onceEvents[e];o;){var a=r&&r[o];a&&(n.off(e,o),delete r[o]),o.call(n,t),s+=a?0:1,o=i[s]}return this}};var y=function(e){function n(o,r){void 0===r&&(r={}),i.assert(Array.isArray(o)||"string"==i.typeOf(o)||i.isElement(o),"`target` should be Element, <Array>Element, String or <Array>String."),e.call(this),this.options=i.mergeOptions(t,r),this.target=o,this.container={};var a=new m(this),l=a.createPicker(),c=new p(this);n.Internal=new v(this),n.Internal.init(),c.when({start:function(){i.addClass(l,s+d)},move:function(e){l.style.left=""+e.x+"px",l.style.top=""+e.y+"px"},end:function(e){i.removeClass(l,s+d),e.y<0&&(l.style.top=0)}})}return n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.show=function(e){n.Internal.show(i.evaluate(e))},n.prototype.hide=function(){n.Internal.hide()},n}(g);return y});
