{"version":3,"sources":["dom/element/appear.js"],"names":["global","document","setInterval","undefined","definition","DomElement","functionMerge","functionDebounce","updateViewport","viewport","left","top","right","innerWidth","documentElement","clientWidth","bottom","innerHeight","clientHeight","updateBoundaries","self","this","properties","storage","uuid","settings","boundaries","treshold","threshold","x","auto","y","isWithinBoundaries","element","rect","getBoundingClientRect","check","node","DomElementAppear","prototype","constructor","call","state","window","on","EVENTS_RESIZE","bind","elements","push","EVENT_APPEAR","EVENT_DISAPPEAR","extend","recur","visibility","i","isVisible","emit","priority","splice","compatMode","Error","provide"],"mappings":"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","file":"dom/element/appear.js","sourcesContent":["/**\n * Qoopido dom/element/appear\n *\n * React on elements entering, leaving or nearing the visible are of the browser window\n *\n * Copyright (c) 2015 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n *\n * @use /demand/validator/isObject\n * @use /demand/validator/isTypeOf\n *\n * @require ../element\n */\n\n(function(global, document, setInterval, undefined) {\n\t'use strict';\n\n\tif(document.compatMode !== 'CSS1Compat') {\n\t\tthrow new Error('Browser needs to be in standards mode');\n\t}\n\n\tfunction definition(DomElement, functionMerge, functionDebounce) {\n\t\tvar documentElement  = document.documentElement,\n\t\t\twindow           = new DomElement(global),\n\t\t\tviewport         = {},\n\t\t\tstorage          = {},\n\t\t\telements         = [],\n\t\t\tEVENTS_RESIZE    = 'resize orientationchange',\n\t\t\tEVENT_APPEAR     = 'appear',\n\t\t\tEVENT_DISAPPEAR  = 'disappear',\n\t\t\tprototype;\n\n\t\tfunction updateViewport() {\n\t\t\tviewport.left   = 0;\n\t\t\tviewport.top    = 0;\n\t\t\tviewport.right  = global.innerWidth || documentElement.clientWidth;\n\t\t\tviewport.bottom = global.innerHeight || documentElement.clientHeight;\n\t\t}\n\n\t\tfunction updateBoundaries() {\n\t\t\tvar self       = this,\n\t\t\t\tproperties = storage[self.uuid],\n\t\t\t\tsettings   = properties.settings,\n\t\t\t\tboundaries = properties.boundaries,\n\t\t\t\ttreshold   = settings.threshold,\n\t\t\t\tx          = (treshold !== undefined) ? treshold : documentElement.clientWidth * settings.auto,\n\t\t\t\ty          = (treshold !== undefined) ? treshold : documentElement.clientHeight * settings.auto;\n\n\t\t\tboundaries.left   = viewport.left - x;\n\t\t\tboundaries.top    = viewport.top - y;\n\t\t\tboundaries.right  = viewport.right + x;\n\t\t\tboundaries.bottom = viewport.bottom + y;\n\t\t}\n\n\t\tfunction isWithinBoundaries(element, boundaries) {\n\t\t\tvar rect = element.getBoundingClientRect();\n\n\t\t\tif(rect.right <= boundaries.left || rect.bottom <= boundaries.top || rect.left >= boundaries.right || rect.top >= boundaries.bottom) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\tfunction check() {\n\t\t\tvar self       = this,\n\t\t\t\tnode       = self.node,\n\t\t\t\tproperties = storage[self.uuid];\n\n\t\t\tif(isWithinBoundaries(node, viewport)) {\n\t\t\t\treturn 2;\n\t\t\t}\n\n\t\t\tif(isWithinBoundaries(node, properties.boundaries)) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t}\n\n\t\tfunction DomElementAppear(element, settings) {\n\t\t\tvar self = DomElement.prototype.constructor.call(this, element),\n\t\t\t\tuuid = self.uuid;\n\n\t\t\tsettings = functionMerge({}, DomElementAppear.settings, settings);\n\n\t\t\tif(settings.threshold === 'auto') {\n\t\t\t\tdelete settings.threshold;\n\t\t\t}\n\n\t\t\tstorage[uuid] = {\n\t\t\t\tsettings:   settings,\n\t\t\t\tboundaries: {},\n\t\t\t\tstate:      -1\n\t\t\t};\n\n\t\t\twindow.on(EVENTS_RESIZE, functionDebounce(updateBoundaries.bind(self)));\n\n\t\t\tupdateBoundaries.call(self);\n\t\t\telements.push(self);\n\n\t\t\treturn self;\n\t\t}\n\n\t\tprototype = DomElement.extend(DomElementAppear);\n\t\tprototype.settings = {\n\t\t\tthreshold:  'auto',\n\t\t\trecur:      true,\n\t\t\tauto:       1,\n\t\t\tvisibility: true\n\t\t};\n\n\t\twindow.on(EVENTS_RESIZE, functionDebounce(updateViewport));\n\t\tupdateViewport();\n\n\t\tsetInterval(function() {\n\t\t\tvar i = 0, element, properties, settings, state;\n\n\t\t\tfor(; element = elements[i]; i++) {\n\t\t\t\tproperties = storage[element.uuid];\n\t\t\t\tsettings   = properties.settings;\n\n\t\t\t\tif(!settings.visibility || element.isVisible()) {\n\t\t\t\t\tstate = check.call(element);\n\n\t\t\t\t\tif(state !== properties.state) {\n\t\t\t\t\t\tswitch(state) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\telement.emit(EVENT_DISAPPEAR, { priority: 1 });\n\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\t\telement.emit(properties.state <= 0 ? EVENT_APPEAR : EVENT_DISAPPEAR, { priority: 2 });\n\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\telement.emit(EVENT_APPEAR, { priority: 1 });\n\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tproperties.state = state;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(!settings.recur && state === 2) {\n\t\t\t\t\t\telements.splice(i, 1);\n\t\t\t\t\t\ti--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, 1000 / 30);\n\n\t\treturn prototype;\n\t}\n\n\tprovide([ '../element', '../../function/merge', '../../function/debounce' ], definition);\n}(this, document, setInterval));"],"sourceRoot":"/source/"}