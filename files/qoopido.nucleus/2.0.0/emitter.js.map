{"version":3,"sources":["emitter.js"],"names":["undefined","definition","base","functionDescriptorGenerate","functionUniqueUuid","getPropertyNames","object","names","i","name","prototype","keys","objectPrototype","objectGetOwnPropertyNames","indexOf","push","__proto__","getPropertyDescriptor","property","descriptor","objectGetOwnPropertyDescriptor","conceal","self","this","constructor","properties","forEach","event","regexMatchExcludedMethods","test","charAt","toUpperCase","slice","value","result","emit","arguments","apply","objectDefineProperty","Emitter","uuid","storage","objectGetPrototypeOf","call","Object","defineProperty","getOwnPropertyNames","getOwnPropertyDescriptor","getPrototypeOf","on","events","fn","pointer","split","one","each","listener","off","j","splice","length","temp","extend","provide"],"mappings":"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","file":"emitter.js","sourcesContent":["/**\n * Qoopido emitter\n *\n * Provides mechanism to emit events and register listeners\n *\n * Copyright (c) 2015 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n *\n * @require ./base\n * @require ./function/unique/uuid\n */\n\n(function(undefined) {\n\t'use strict';\n\n\tfunction definition(base, functionDescriptorGenerate, functionUniqueUuid) {\n\t\tvar regexMatchExcludedMethods      = /^(_|((get|has|is)([A-Z]|$))|(on|one|off|emit)$)/,\n\t\t\tobjectDefineProperty           = Object.defineProperty,\n\t\t\tobjectGetOwnPropertyNames      = Object.getOwnPropertyNames,\n\t\t\tobjectGetOwnPropertyDescriptor = Object.getOwnPropertyDescriptor,\n\t\t\tobjectGetPrototypeOf           = Object.getPrototypeOf,\n\t\t\tobjectPrototype                = Object.prototype,\n\t\t\tstorage                        = {};\n\n\t\tfunction getPropertyNames(object) {\n\t\t\tvar prototype = object,\n\t\t\t\tkeys      = [],\n\t\t\t\tnames, i, name;\n\n\t\t\twhile(prototype !== objectPrototype) {\n\t\t\t\tfor(names = objectGetOwnPropertyNames(prototype), i = 0; name = names[i]; i++) {\n\t\t\t\t\tkeys.indexOf(name) === -1 && keys.push(name);\n\t\t\t\t}\n\n\t\t\t\tprototype = prototype.__proto__;\n\t\t\t}\n\n\t\t\treturn keys;\n\t\t}\n\n\t\tfunction getPropertyDescriptor(object, property) {\n\t\t\tvar prototype = object,\n\t\t\t\tdescriptor;\n\n\t\t\twhile(prototype && !(descriptor = objectGetOwnPropertyDescriptor(prototype, property))) {\n\t\t\t\tprototype = prototype.__proto__;\n\t\t\t}\n\n\t\t\treturn descriptor;\n\t\t}\n\n\t\tfunction conceal() {\n\t\t\tvar self       = this,\n\t\t\t\tprototype  = self.constructor.prototype,\n\t\t\t\tproperties = getPropertyNames(prototype);\n\n\t\t\tproperties.forEach(function(property) {\n\t\t\t\tvar descriptor = getPropertyDescriptor(prototype, property),\n\t\t\t\t\tevent;\n\n\t\t\t\tif(typeof self[property] === 'function' && regexMatchExcludedMethods.test(property) === false) {\n\t\t\t\t\tevent = property.charAt(0).toUpperCase() + property.slice(1);\n\n\t\t\t\t\tdescriptor.value = function() {\n\t\t\t\t\t\tvar result;\n\n\t\t\t\t\t\tself.emit('pre' + event, arguments);\n\n\t\t\t\t\t\tresult = prototype[property].apply(self, arguments);\n\n\t\t\t\t\t\tself.emit('post' + event, arguments, result);\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t};\n\n\t\t\t\t\tobjectDefineProperty(self, property, descriptor);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction Emitter() {\n\t\t\tvar self = this,\n\t\t\t\tuuid = self.uuid;\n\n\t\t\t!uuid && (uuid = functionUniqueUuid()) && objectDefineProperty(self, 'uuid', functionDescriptorGenerate(uuid));\n\n\t\t\tstorage[uuid] = {};\n\n\t\t\tif(objectGetPrototypeOf(self) !== Emitter.prototype) {\n\t\t\t\tconceal.call(self);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t}\n\n\t\tEmitter.prototype = {\n\t\t\t/* only for reference\n\t\t\tuuid: null,\n\t\t\t*/\n\t\t\ton: function(events, fn) {\n\t\t\t\tvar self    = this,\n\t\t\t\t\tpointer = storage[self.uuid],\n\t\t\t\t\ti = 0, event;\n\n\t\t\t\tevents = events.split(' ');\n\n\t\t\t\tfor(; (event = events[i]) !== undefined; i++) {\n\t\t\t\t\t(pointer[event] = pointer[event] || []).push(fn);\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t},\n\t\t\tone: function(events, fn, each) {\n\t\t\t\tvar self = this;\n\n\t\t\t\teach = (each !== false);\n\n\t\t\t\tself.on(events, function listener(event) {\n\t\t\t\t\tself.off(((each === true) ? event : events), listener);\n\n\t\t\t\t\tfn.apply(this, arguments);\n\t\t\t\t});\n\n\t\t\t\treturn self;\n\t\t\t},\n\t\t\toff: function(events, fn) {\n\t\t\t\tvar self    = this,\n\t\t\t\t\tpointer = storage[self.uuid],\n\t\t\t\t\ti = 0, event, j, listener;\n\n\t\t\t\tif(events) {\n\t\t\t\t\tevents = events.split(' ');\n\n\t\t\t\t\tfor(; (event = events[i]) !== undefined; i++) {\n\t\t\t\t\t\tpointer[event] = pointer[event] || [];\n\n\t\t\t\t\t\tif(fn) {\n\t\t\t\t\t\t\tfor(j = 0; (listener = pointer[event][j]) !== undefined; j++) {\n\t\t\t\t\t\t\t\tif(listener === fn) {\n\t\t\t\t\t\t\t\t\tpointer[event].splice(j, 1);\n\n\t\t\t\t\t\t\t\t\tj--;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpointer[event].length = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor(event in self.listener) {\n\t\t\t\t\t\tpointer[event].length = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t},\n\t\t\temit: function(event) {\n\t\t\t\tvar self = this,\n\t\t\t\t\tpointer, temp, i = 0, listener;\n\n\t\t\t\tif(event) {\n\t\t\t\t\tpointer = storage[self.uuid];\n\n\t\t\t\t\tpointer[event] = pointer[event] || [];\n\t\t\t\t\ttemp           = pointer[event].slice();\n\n\t\t\t\t\tfor(; (listener = temp[i]) !== undefined; i++) {\n\t\t\t\t\t\tlistener.apply(self, arguments);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\t\t};\n\n\t\treturn base.extend(Emitter);\n\t}\n\n\tprovide([ './base', './function/descriptor/generate', './function/unique/uuid' ], definition);\n}());"],"sourceRoot":"/source/"}