(function(){"use strict";angular.module("tubular-chart.directives",["tubular.services","chart.js"]).directive("tbChartjs",[function(){return{template:'<div class="tubular-chart"><canvas class="chart chart-base" chart-type="chartType" chart-data="data" chart-labels="labels"  chart-legend="{{showLegend}}" chart-series="series" chart-click="onClick"><\/canvas><div class="alert alert-info" ng-show="isEmpty">{{emptyMessage}}<\/div><div class="alert alert-warning" ng-show="hasError">{{errorMessage}}<\/div><\/div>',restrict:"E",replace:!0,scope:{serverUrl:"@",requireAuthentication:"=?",showLegend:"@?",name:"@?chartName",chartType:"@?",emptyMessage:"@?",errorMessage:"@?",onLoad:"=?",onClick:"=?"},controller:["$scope","tubularHttp",function(n,t){n.tubularDirective="tubular-chart";n.dataService=t.getDataService(n.dataServiceName);n.showLegend=angular.isUndefined(n.showLegend)?!0:n.showLegend;n.chartType=n.chartType||"Line";n.requireAuthentication=angular.isUndefined(n.requireAuthentication)?!0:n.requireAuthentication;n.loadData=function(){t.setRequireAuthentication(n.requireAuthentication);t.get(n.serverUrl).promise.then(function(t){if(!t||!t.Data||t.Data.length===0){if(n.isEmpty=!0,n.options.series=[{data:[]}],n.onLoad)n.onLoad(n.options,{});return}if(n.isEmpty=!1,n.data=t.Data,n.series=t.Series,n.labels=t.Labels,n.onLoad)n.onLoad(n.options,t)},function(t){n.$emit("tbChart_OnConnectionError",t)})};n.$watch("serverUrl",function(t){angular.isDefined(t)&&t!=null&&n.loadData()})}]}}])})(),function(n){"use strict";typeof exports=="object"?module.exports=n(require("angular"),require("chart.js")):typeof define=="function"&&define.amd?define(["angular","chart"],n):n(angular,Chart)}(function(n,t){"use strict";function r(){var i={},r={Chart:t,getOptions:function(t){var r=t&&i[t]||{};return n.extend({},i,r)}};this.setOptions=function(t,r){if(!r){r=t;i=n.extend(i,r);return}i[t]=n.extend(i[t]||{},r)};this.$get=function(){return r}}function u(r,u){function a(n,t){return n&&t&&n.length&&t.length?Array.isArray(n[0])?n.length===t.length&&n.every(function(n,i){return n.length===t[i].length}):t.reduce(v,0)>0?n.length===t.length:!1:!1}function v(n,t){return n+t}function o(t,i,r,u){var f=null;return function(e){var s=i.getPointsAtEvent||i.getBarsAtEvent||i.getSegmentsAtEvent,o;s&&(o=s.call(i,e),(u===!1||n.equals(f,o)===!1)&&(f=o,t[r](o,e),t.$apply()))}}function y(i,u){for(var f=n.copy(u.colours||r.getOptions(i).colours||t.defaults.global.colours);f.length<u.data.length;)f.push(u.getColour());return f.map(p)}function p(n){return typeof n=="object"&&n!==null?n:typeof n=="string"&&n[0]==="#"?h(w(n.substr(1))):s()}function s(){var n=[e(0,255),e(0,255),e(0,255)];return h(n)}function h(n){return{fillColor:f(n,.2),strokeColor:f(n,1),pointColor:f(n,1),pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:f(n,.8)}}function e(n,t){return Math.floor(Math.random()*(t-n+1))+n}function f(n,t){return i?"rgb("+n.join(",")+")":"rgba("+n.concat(t).join(",")+")"}function w(n){var t=parseInt(n,16),i=t>>16&255,r=t>>8&255,u=t&255;return[i,r,u]}function b(t,i,r,u){return{labels:t,datasets:i.map(function(t,i){return n.extend({},u[i],{label:r[i],data:t})})}}function k(t,i,r){return t.map(function(t,u){return n.extend({},r[u],{label:t,value:i[u],color:r[u].strokeColor,highlight:r[u].pointHighlightStroke})})}function c(n,t){var i=n.parent(),r=i.find("chart-legend"),u="<chart-legend>"+t.generateLegend()+"<\/chart-legend>";r.length?r.replaceWith(u):i.append(u)}function d(n,t,i,r){Array.isArray(i.data[0])?n.datasets.forEach(function(n,i){(n.points||n.bars).forEach(function(n,r){n.value=t[i][r]})}):n.segments.forEach(function(n,i){n.value=t[i]});n.update();i.$emit("update",n);i.legend&&i.legend!=="false"&&c(r,n)}function l(n){return!n||Array.isArray(n)&&!n.length||typeof n=="object"&&!Object.keys(n).length}function g(i,u){var f=n.extend({},t.defaults.global,r.getOptions(i),u.options);return f.responsive}return function(t){return{restrict:"CA",scope:{data:"=?",labels:"=?",options:"=?",series:"=?",colours:"=?",getColour:"=?",chartType:"=",legend:"@",click:"=?",hover:"=?",chartData:"=?",chartLabels:"=?",chartOptions:"=?",chartSeries:"=?",chartColours:"=?",chartLegend:"@",chartClick:"=?",chartHover:"=?"},link:function(f,e){function v(n,t){f.$watch(n,function(n){typeof n!="undefined"&&(f[t]=n)})}function w(i,r){if(!l(i)&&!n.equals(i,r)){var u=t||f.chartType;u&&(h&&h.destroy(),nt(u))}}function nt(t){if(g(t,f)&&e[0].clientHeight===0&&p.clientHeight===0)return u(function(){nt(t)},50,!1);if(f.data&&f.data.length){f.getColour=typeof f.getColour=="function"?f.getColour:s;f.colours=y(t,f);var i=e[0],l=i.getContext("2d"),a=Array.isArray(f.data[0])?b(f.labels,f.data,f.series||[],f.colours):k(f.labels,f.data,f.colours),v=n.extend({},r.getOptions(t),f.options);h=new r.Chart(l)[t](a,v);f.$emit("create",h);i.onclick=f.click?o(f,h,"click",!1):n.noop;i.onmousemove=f.hover?o(f,h,"hover",!0):n.noop;f.legend&&f.legend!=="false"&&c(e,h)}}function tt(n){if(typeof console!="undefined"&&r.getOptions().env!=="test"){var t=typeof console.warn=="function"?console.warn:console.log;!f[n]||t.call(console,'"%s" is deprecated and will be removed in a future version. Please use "chart-%s" instead.',n,n)}}var h,p=document.createElement("div");p.className="chart-container";e.replaceWith(p);p.appendChild(e[0]);i&&window.G_vmlCanvasManager.initElement(e[0]);["data","labels","options","series","colours","legend","click","hover"].forEach(tt);v("chartData","data");v("chartLabels","labels");v("chartOptions","options");v("chartSeries","series");v("chartColours","colours");v("chartLegend","legend");v("chartClick","click");v("chartHover","hover");f.$watch("data",function(n,i){if(n&&n.length&&(!Array.isArray(n[0])||n[0].length)){var r=t||f.chartType;if(r){if(h){if(a(n,i))return d(h,n,f,e);h.destroy()}nt(r)}}},!0);f.$watch("series",w,!0);f.$watch("labels",w,!0);f.$watch("options",w,!0);f.$watch("colours",w,!0);f.$watch("chartType",function(t,i){l(t)||n.equals(t,i)||(h&&h.destroy(),nt(t))});f.$on("$destroy",function(){h&&h.destroy()})}}}}t.defaults.global.responsive=!0;t.defaults.global.multiTooltipTemplate="<%if (datasetLabel){%><%=datasetLabel%>: <%}%><%= value %>";t.defaults.global.colours=["#97BBCD","#DCDCDC","#F7464A","#46BFBD","#FDB45C","#949FB1","#4D5360"];var i=typeof G_vmlCanvasManager=="object"&&window.G_vmlCanvasManager!==null&&typeof window.G_vmlCanvasManager.initElement=="function";return i&&(t.defaults.global.animation=!1),n.module("chart.js",[]).provider("ChartJs",r).factory("ChartJsFactory",["ChartJs","$timeout",u]).directive("chartBase",["ChartJsFactory",function(n){return new n}]).directive("chartLine",["ChartJsFactory",function(n){return new n("Line")}]).directive("chartBar",["ChartJsFactory",function(n){return new n("Bar")}]).directive("chartRadar",["ChartJsFactory",function(n){return new n("Radar")}]).directive("chartDoughnut",["ChartJsFactory",function(n){return new n("Doughnut")}]).directive("chartPie",["ChartJsFactory",function(n){return new n("Pie")}]).directive("chartPolarArea",["ChartJsFactory",function(n){return new n("PolarArea")}])});