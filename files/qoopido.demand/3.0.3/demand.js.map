{"version":3,"sources":["demand.js"],"names":["global","document","JSON","XMLHttpRequest","setTimeout","clearTimeout","snippet","demand","dependency","self","this","window","NULL","dependencies","arrayPrototypeSlice","call","arguments","i","resolve","Pledge","all","configure","parameter","key","cache","version","timeout","lifetime","base","pattern","modules","pointer","settings","isTypeOf","STRING_BOOLEAN","weight","state","isObject","length","STRING_STRING","isPositiveInteger","Math","min","max","Pattern","MODULE_PREFIX_STORAGE","remove","path","registry","storage","clean","mocks","on","events","callback","event","STRING_FUNCTION","split","shift","regexMatchEvent","test","listener","push","emit","apply","list","keys","pledge","Object","provide","deferred","isFunction","isArray","definition","queue","current","items","process","defer","PLEDGE_PENDING","then","log","Reason","error","console","toString","mock","module","pledges","match","regexMatchParameter","replace","slice","join","loader","assign","id","factory","escapeRegularExpression","value","regexMatchRegex","createRegularExpression","expression","modifier","RegExp","getTimestamp","Date","objectPrototypeToString","object","type","isInstanceOf","isFinite","floor","executor","handle","PLEDGE_RESOLVED","reject","PLEDGE_REJECTED","aState","aParameter","result","forEach","handler","defered","resolved","rejected","aResolved","aRejected","url","regexMatchTrailingSlash","matchPattern","matchUrl","message","stack","Queue","Loader","xhr","MODULE_PREFIX_HANDLER","onPreRequest","get","regexMatchBaseUrl","XHR","XDR","onprogress","ontimeout","onerror","onabort","onload","getResponseHeader","status","matchType","source","responseText","onPostRequest","set","open","send","readyState","abort","arrayPrototype","Array","prototype","arrayPrototypeConcat","concat","objectPrototype","resolver","createElement","DEMAND_ID","PROVIDE_ID","SETTINGS_ID","MODULE_PREFIX","MODULE_PREFIX_LOCAL","MODULE_PREFIX_SETTINGS","MODULE_PREFIX_VALIDATOR","XDomainRequest","regexIsAbsolutePath","regexIsAbsoluteUri","href","context","scopedDemand","bind","matches","onPreProcess","add","aResolve","aReject","checkState","countResolved","countTotal","index","race","traverse","depth","indention","item","/demand","location","target","getElementsByTagName","regexMatchSourcemap","replacement","exec","protocol","host","script","async","text","setAttribute","appendChild","isEnabled","indexOf","Storage","STORAGE_PREFIX","STORAGE_SUFFIX_STATE","STORAGE_SUFFIX_VALUE","regexMatchState","localStorage","exception","hasRemainingSpace","parse","getItem","expires","clear","spaceBefore","remainingSpace","setItem","stringify","removeItem","expired","main"],"mappings":"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","file":"demand.js","sourcesContent":["/**\n * Qoopido demand\n *\n * Promise like module loader (XHR) with localStorage caching\n *\n * Copyright (c) 2016 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(global, document, JSON, XMLHttpRequest, setTimeout, clearTimeout, snippet) {\n\t'use strict';\n\t\n\tvar arrayPrototype          = Array.prototype,\n\t\tarrayPrototypeSlice     = arrayPrototype.slice,\n\t\tarrayPrototypeConcat    = arrayPrototype.concat,\n\t\tobjectPrototype         = Object.prototype,\n\t\tobjectPrototypeToString = objectPrototype.toString,\n\t\tresolver                = document.createElement('a'),\n\t\tDEMAND_ID               = 'demand',\n\t\tPROVIDE_ID              = 'provide',\n\t\tSETTINGS_ID             = 'settings',\n\t\tMODULE_PREFIX           = '/' + DEMAND_ID + '/',\n\t\tMODULE_PREFIX_STORAGE   = MODULE_PREFIX + 'storage/',\n\t\tMODULE_PREFIX_HANDLER   = MODULE_PREFIX + 'handler/',\n\t\tMODULE_PREFIX_LOCAL     = MODULE_PREFIX + 'local',\n\t\tMODULE_PREFIX_SETTINGS  = MODULE_PREFIX + 'settings',\n\t\tMODULE_PREFIX_VALIDATOR = MODULE_PREFIX + 'validator/',\n\t\tPLEDGE_PENDING          = 'pending',\n\t\tPLEDGE_RESOLVED         = 'resolved',\n\t\tPLEDGE_REJECTED         = 'rejected',\n\t\tSTRING_STRING           = 'string',\n\t\tSTRING_BOOLEAN          = 'boolean',\n\t\tSTRING_FUNCTION         = 'function',\n\t\tNULL                    = null,\n\t\tXHR                     = XMLHttpRequest,\n\t\tXDR                     = 'XDomainRequest' in global &&  global.XDomainRequest || XHR,\n\t\tregexIsAbsolutePath     = /^\\//,\n\t\tregexIsAbsoluteUri      = /^(http(s?):)?\\/\\//i,\n\t\tregexMatchTrailingSlash = /(.+)\\/$/,\n\t\tregexMatchParameter     = /^(mock:)?([+-])?((?:[-\\w]+\\/?)+)?(?:@(\\d+\\.\\d+.\\d+))?(?:#(\\d+))?!/,\n\t\tregexMatchRegex         = /[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g,\n\t\tregexMatchEvent         = /^cache(Miss|Hit|Clear|Exceed)|(pre|post)(Request|Process|Cache)$/,\n\t\tsettings                = { cache: {}, timeout: 8 * 1000, pattern: {}, modules: {}, handler: 'module' },\n\t\tregistry                = {},\n\t\tmocks                   = {},\n\t\tlistener                = {},\n\t\tresolve, regexMatchBaseUrl, queue, storage;\n\n\t/**\n\t * /demand\n\t */\n\tfunction demand() {\n\t\tvar self         = this !== window ? this : NULL,\n\t\t\tdependencies = arrayPrototypeSlice.call(arguments),\n\t\t\ti = 0, dependency;\n\t\t\n\t\tfor(; (dependency = dependencies[i]); i++) {\n\t\t\tdependencies[i] = resolve.dependency(dependency, self);\n\t\t}\n\t\t\n\t\treturn Pledge.all(dependencies);\n\t}\n\t\n\tfunction configure(parameter) {\n\t\tvar cache    = parameter.cache,\n\t\t\tversion  = parameter.version,\n\t\t\ttimeout  = parameter.timeout,\n\t\t\tlifetime = parameter.lifetime,\n\t\t\tbase     = parameter.base,\n\t\t\tpattern  = parameter.pattern,\n\t\t\tmodules  = parameter.modules,\n\t\t\tpointer  = settings.modules,\n\t\t\tkey;\n\n\t\tif(isTypeOf(cache, STRING_BOOLEAN)) {\n\t\t\tsettings.cache[''] = { weight: 0, state: cache };\n\t\t} else if(isObject(cache)) {\n\t\t\tfor(key in cache) {\n\t\t\t\tsettings.cache[key] = { weight: key.length, state: cache[key] };\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(isTypeOf(version, STRING_STRING)) {\n\t\t\tsettings.version = version;\n\t\t}\n\t\t\n\t\tif(isPositiveInteger(timeout)) {\n\t\t\tsettings.timeout = Math.min(Math.max(timeout, 2), 12) * 1000;\n\t\t}\n\t\t\n\t\tif(isPositiveInteger(lifetime) && lifetime > 0) {\n\t\t\tsettings.lifetime = lifetime * 1000;\n\t\t}\n\t\t\n\t\tif(isTypeOf(base, STRING_STRING) && base !== '') {\n\t\t\tsettings.pattern.base = new Pattern('', base);\n\t\t}\n\t\t\n\t\tif(isObject(pattern)) {\n\t\t\tfor(key in pattern) {\n\t\t\t\tkey !== 'base' && (settings.pattern[key] = new Pattern(key, pattern[key]));\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(isObject(modules)) {\n\t\t\tfor(key in modules) {\n\t\t\t\tif(key !== MODULE_PREFIX_STORAGE) {\n\t\t\t\t\tpointer[key] = modules[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction remove(path) {\n\t\tif(registry[path]) {\n\t\t\t!!registry[path].cache && storage.clean.path(path);\n\t\t\t\n\t\t\tdelete registry[path];\n\t\t\tdelete mocks[path];\n\t\t}\n\t}\n\t\n\tfunction on(events, callback) {\n\t\tvar event;\n\t\t\n\t\tif(isTypeOf(events, STRING_STRING) && isTypeOf(callback, STRING_FUNCTION)) {\n\t\t\tevents = events.split(' ');\n\t\t\t\n\t\t\twhile(event = events.shift()) {\n\t\t\t\tif(regexMatchEvent.test(event)) {\n\t\t\t\t\t(listener[event] || (listener[event] = [])).push(callback);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn demand;\n\t}\n\t\n\tfunction emit(event) {\n\t\tvar pointer = listener[event],\n\t\t\tparameter, i, callback;\n\t\t\n\t\tif(pointer) {\n\t\t\tparameter = arrayPrototypeSlice.call(arguments, 1);\n\t\t\t\n\t\t\tfor(i = 0; (callback = pointer[i]); i++) {\n\t\t\t\tcallback.apply(NULL, parameter);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction list(state) {\n\t\tvar keys, path, pledge;\n\t\t\n\t\tif(state) {\n\t\t\tkeys = [];\n\t\t\t\n\t\t\tfor(path in registry) {\n\t\t\t\tpledge = registry[path].pledge;\n\t\t\t\t\n\t\t\t\tif(pledge.state === state || pledge.cache === state) {\n\t\t\t\t\tkeys.push(path);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tkeys = Object.keys(registry);\n\t\t}\n\t\t\n\t\treturn keys;\n\t}\n\t\n\t/**\n\t * /provide\n\t */\n\tfunction provide() {\n\t\tvar parameter    = arguments,\n\t\t\tpath         = isTypeOf(parameter[0], STRING_STRING) ? parameter[0] : NULL,\n\t\t\tdependencies = isArray(parameter[path ? 1 : 0]) ? parameter[path ? 1 : 0] : NULL,\n\t\t\tdefinition   = dependencies ? parameter[path ? 2 : 1] : parameter[path ? 1 : 0],\n\t\t\tdeferred, pledge, isFunction;\n\t\t\n\t\tif(!path && queue.current) {\n\t\t\tpath = queue.current.path;\n\t\t\t\n\t\t\tqueue.current = NULL;\n\t\t\t\n\t\t\tqueue.items > 0 && queue.process();\n\t\t}\n\t\t\n\t\tif(path) {\n\t\t\tpath       = resolve.path(path, this);\n\t\t\tdeferred   = registry[path] || (registry[path] = Pledge.defer());\n\t\t\tpledge     = deferred.pledge;\n\t\t\tisFunction = isTypeOf(definition, STRING_FUNCTION);\n\t\t\t\n\t\t\tif(pledge.state === PLEDGE_PENDING) {\n\t\t\t\tif(dependencies) {\n\t\t\t\t\tdemand\n\t\t\t\t\t\t.apply(path, dependencies)\n\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\tfunction() { deferred.resolve(isFunction ? definition.apply(NULL, arguments) : definition); },\n\t\t\t\t\t\t\tfunction() { log(new Reason('error providing', path, arguments)); }\n\t\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tdeferred.resolve(isFunction ? definition() : definition);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthrow 'unspecified anonymous provide';\n\t\t}\n\t}\n\t\n\tresolve = {\n\t\t/**\n\t\t * /demand/modifier/resolveUrl\n\t\t *\n\t\t * @param url\n\t\t *\n\t\t * @returns {string}\n\t\t */\n\t\turl: function(url) {\n\t\t\tresolver.href = url;\n\t\t\t\n\t\t\treturn resolver.href;\n\t\t},\n\t\tpath: function(path, context) {\n\t\t\tpath = path.replace(regexMatchParameter, '');\n\t\t\t\n\t\t\tif(!regexIsAbsolutePath.test(path) && !regexIsAbsoluteUri.test(path)) {\n\t\t\t\tpath = '/' + resolve.url(((context && resolve.url(context + '/../')) || '/') + path).replace(regexMatchBaseUrl, '');\n\t\t\t}\n\t\t\t\n\t\t\treturn path;\n\t\t},\n\t\tdependency: function(dependency, context) {\n\t\t\tvar path = isTypeOf(dependency, STRING_STRING) ? resolve.path(dependency, context) : NULL,\n\t\t\t\tdefinition, deferred;\n\t\t\t\n\t\t\tif(path) {\n\t\t\t\tif(context && (dependency === DEMAND_ID || dependency === PROVIDE_ID || dependency === SETTINGS_ID)) {\n\t\t\t\t\tswitch(dependency) {\n\t\t\t\t\t\tcase DEMAND_ID:\n\t\t\t\t\t\t\tpath       = MODULE_PREFIX_LOCAL + path;\n\t\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\t\tvar scopedDemand = demand.bind(context),\n\t\t\t\t\t\t\t\t\tkey;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tfor(key in demand) {\n\t\t\t\t\t\t\t\t\tscopedDemand[key] = demand[key];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn scopedDemand;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase PROVIDE_ID:\n\t\t\t\t\t\t\tpath       = MODULE_PREFIX_LOCAL + path;\n\t\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\t\treturn provide.bind(context);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase SETTINGS_ID:\n\t\t\t\t\t\t\tpath       = MODULE_PREFIX_SETTINGS + context;\n\t\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\t\treturn settings.modules[context] || NULL;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t!registry[path] && provide(path, definition);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn (registry[path] || (registry[path] = new Loader(path, resolve.parameter(dependency, context)))).pledge;\n\t\t\t} else {\n\t\t\t\tdeferred = Pledge.defer();\n\t\t\t\t\n\t\t\t\tdeferred.resolve(dependency);\n\t\t\t\t\n\t\t\t\treturn deferred.pledge;\n\t\t\t}\n\t\t},\n\t\tparameter: function(path, context) {\n\t\t\tvar parameter = path.match(regexMatchParameter),\n\t\t\t\tpattern   = settings.pattern,\n\t\t\t\tkey, match;\n\t\t\t\n\t\t\tpath = resolve.path(path, context);\n\t\t\t\n\t\t\tif(!regexIsAbsoluteUri.test(path)) {\n\t\t\t\tfor(key in pattern) {\n\t\t\t\t\tpattern[key].matches(path) && (!match || match.weight < pattern[key].weight) && (match = pattern[key]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tmock:     (parameter && parameter[1]) ? true : false,\n\t\t\t\tcache:    (parameter && parameter[2]) ? parameter[2] === '+' : NULL,\n\t\t\t\thandler:  (parameter && parameter[3]) || settings.handler,\n\t\t\t\tversion:  (parameter && parameter[4]) || settings.version,\n\t\t\t\tlifetime: (parameter && parameter[5] && parameter[5] * 1000) || settings.lifetime,\n\t\t\t\turl:      match ? resolve.url(match.process(path)) : path\n\t\t\t};\n\t\t},\n\t\tloader: function(loader) {\n\t\t\tvar handler = loader.handler;\n\t\t\t\n\t\t\temit('preProcess', loader);\n\t\t\t\n\t\t\tif(loader.deferred.pledge.state === PLEDGE_PENDING) {\n\t\t\t\thandler.onPreProcess && handler.onPreProcess.call(loader);\n\t\t\t\thandler.process && queue.add(loader);\n\t\t\t}\n\t\t}\n\t};\n\t\n\tfunction log(error) {\n\t\t/* eslint-disable no-console */\n\t\tif(!isTypeOf(console, 'undefined')) {\n\t\t\tconsole.error(error.toString());\n\t\t}\n\t\t/* eslint-enable no-console */\n\t}\n\t\n\t/**\n\t * /demand/mock\n\t *\n\t * @param modules\n\t *\n\t * @return {Pledge}\n\t */\n\tfunction mock(modules) {\n\t\tvar pledges = [],\n\t\t\ti = 0, module, pledge, parameter;\n\t\t\n\t\tfor(; (module = modules[i]); i++) {\n\t\t\tparameter     = module.match(regexMatchParameter);\n\t\t\tmodule        = module.replace(regexMatchParameter, '');\n\t\t\tmodules[i]    = (parameter ? 'mock:' + parameter.slice(1).join('')  : 'mock:') + '!' + module;\n\t\t\tpledge        = (mocks[module] = Pledge.defer()).pledge;\n\t\t\t\n\t\t\tpledge.then(function(loader) { delete mocks[loader.path]; });\n\t\t\t\n\t\t\tpledges.push(pledge);\n\t\t}\n\t\t\n\t\tdemand.apply(NULL, modules);\n\t\t\n\t\treturn Pledge.all(pledges);\n\t}\n\t\n\tfunction assign(id, factory) {\n\t\tprovide(id, function() { return factory; });\n\t}\n\t\n\tfunction escapeRegularExpression(value) {\n\t\treturn value.replace(regexMatchRegex, '\\\\$&');\n\t}\n\t\n\tfunction createRegularExpression(expression, modifier) {\n\t\treturn new RegExp(expression, modifier);\n\t}\n\t\n\tfunction getTimestamp() {\n\t\treturn +new Date();\n\t}\n\t\n\t/**\n\t * /demand/validator/isArray\n\t *\n\t * @param value\n\t *\n\t * @returns {boolean}\n\t */\n\tfunction isArray(value) {\n\t\treturn objectPrototypeToString.call(value) === '[object Array]';\n\t}\n\t\n\t/**\n\t * /demand/validator(isObject\n\t *\n\t * @param object\n\t *\n\t * @returns {boolean}\n\t */\n\tfunction isObject(object) {\n\t\treturn object && isTypeOf(object, 'object');\n\t}\n\t\n\t/**\n\t * /demand/validator/isTypeOf\n\t *\n\t * @param object\n\t * @param type\n\t *\n\t * @returns {boolean}\n\t */\n\tfunction isTypeOf(object, type) {\n\t\treturn typeof object === type;\n\t}\n\t\n\t/**\n\t * /demand/validator/isInstanceOf\n\t *\n\t * @param object\n\t * @param module\n\t *\n\t * @returns {boolean}\n\t */\n\tfunction isInstanceOf(object, module) {\n\t\treturn object instanceof module;\n\t}\n\t\n\t/**\n\t * /demand/validator/isPositiveInteger\n\t *\n\t * @param value\n\t *\n\t * @returns {boolean}\n\t */\n\tfunction isPositiveInteger(value) {\n\t\treturn isTypeOf(value, 'number') && isFinite(value) && Math.floor(value) === value && value >= 0;\n\t}\n\t\n\t/**\n\t * /demand/pledge\n\t *\n\t * @param executor\n\t *\n\t * @constructor\n\t */\n\tfunction Pledge(executor) {\n\t\tvar self     = this,\n\t\t\tlistener = { resolved: [], rejected: [] };\n\t\t\n\t\tfunction resolve() {\n\t\t\thandle(PLEDGE_RESOLVED, arguments);\n\t\t}\n\t\t\n\t\tfunction reject() {\n\t\t\thandle(PLEDGE_REJECTED, arguments);\n\t\t}\n\t\t\n\t\tfunction handle(aState, aParameter) {\n\t\t\tvar result;\n\n\t\t\tif(self.state === PLEDGE_PENDING) {\n\t\t\t\tself.state = aState;\n\t\t\t\tself.value = aParameter;\n\t\t\t\t\n\t\t\t\tlistener[aState].forEach(function(pointer) {\n\t\t\t\t\tresult = pointer.handler.apply(NULL, aParameter);\n\n\t\t\t\t\tif(result && typeof result.then === 'function') {\n\t\t\t\t\t\tresult.then(pointer.defered.resolve, pointer.defered.reject);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpointer.defered.resolve(result);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\tself.then = function(aResolved, aRejected) {\n\t\t\tvar defered = Pledge.defer();\n\t\t\t\n\t\t\tif(self.state === PLEDGE_PENDING) {\n\t\t\t\taResolved && listener[PLEDGE_RESOLVED].push({ handler: aResolved, defered: defered });\n\t\t\t\taRejected && listener[PLEDGE_REJECTED].push({ handler: aRejected, defered: defered });\n\t\t\t} else {\n\t\t\t\tswitch(self.state) {\n\t\t\t\t\tcase PLEDGE_RESOLVED:\n\t\t\t\t\t\tdefered.resolve(aResolved && aResolved.apply(NULL, self.value));\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PLEDGE_REJECTED:\n\t\t\t\t\t\tdefered.reject(aRejected && aRejected.apply(NULL, self.value));\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn defered.pledge;\n\t\t};\n\t\t\n\t\texecutor(resolve, reject);\n\t}\n\t\n\tPledge.prototype = {\n\t\tstate:  PLEDGE_PENDING\n\t\t/* only for reference\n\t\t value:  NULL,\n\t\t then:   NULL,\n\t\t cache:  NULL, // will only be set by storage\n\t\t */\n\t};\n\t\n\tPledge.defer = function() {\n\t\tvar self = {};\n\t\t\n\t\tself.pledge = new Pledge(function(aResolve, aReject) {\n\t\t\tself.resolve = aResolve;\n\t\t\tself.reject  = aReject;\n\t\t});\n\t\t\n\t\treturn self;\n\t};\n\t\n\tPledge.all = function(pledges) {\n\t\tvar deferred      = Pledge.defer(),\n\t\t\tresolved      = [],\n\t\t\trejected      = [],\n\t\t\tcountTotal    = pledges.length,\n\t\t\tcountResolved = 0;\n\t\t\n\t\tfunction checkState() {\n\t\t\tif(countResolved === countTotal) {\n\t\t\t\tdeferred.resolve.apply(NULL, arrayPrototypeConcat.apply([], resolved));\n\t\t\t} else if(rejected.length + countResolved === countTotal) {\n\t\t\t\tdeferred.reject.apply(NULL, arrayPrototypeConcat.apply([], rejected));\n\t\t\t}\n\t\t}\n\t\t\n\t\tpledges.forEach(function(pledge, index) {\n\t\t\tpledge.then(\n\t\t\t\tfunction() {\n\t\t\t\t\tresolved[index] = arrayPrototypeSlice.call(arguments);\n\t\t\t\t\t\n\t\t\t\t\tcountResolved++;\n\t\t\t\t\t\n\t\t\t\t\tcheckState();\n\t\t\t\t},\n\t\t\t\tfunction() {\n\t\t\t\t\trejected.push(arrayPrototypeSlice.call(arguments));\n\t\t\t\t\t\n\t\t\t\t\tcheckState();\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t\t\n\t\treturn deferred.pledge;\n\t};\n\t\n\tPledge.race = function(pledges) {\n\t\tvar deferred = Pledge.defer();\n\t\t\n\t\tpledges.forEach(function(pledge) {\n\t\t\tpledge.then(\n\t\t\t\tdeferred.resolve,\n\t\t\t\tdeferred.reject\n\t\t\t);\n\t\t});\n\t\t\n\t\treturn deferred.pledge;\n\t};\n\t\n\tfunction Pattern(pattern, url) {\n\t\tvar self = this;\n\t\t\n\t\tself.weight       = pattern.length;\n\t\tself.url          = resolve.url(url).replace(regexMatchTrailingSlash, '$1');\n\t\tself.matchPattern = createRegularExpression('^' + escapeRegularExpression(pattern));\n\t\tself.matchUrl     = createRegularExpression('^' + escapeRegularExpression(url));\n\t}\n\t\n\tPattern.prototype = {\n\t\t/* only for reference\n\t\t weight:       0,\n\t\t url:          NULL,\n\t\t matchPattern: NULL,\n\t\t matchUrl:     NULL,\n\t\t */\n\t\tmatches: function(path) {\n\t\t\treturn this.matchPattern.test(path);\n\t\t},\n\t\tremove: function(url) {\n\t\t\treturn url.replace(this.matchUrl, '');\n\t\t},\n\t\tprocess: function(path) {\n\t\t\tvar self = this;\n\t\t\t\n\t\t\treturn path.replace(self.matchPattern, self.url);\n\t\t}\n\t};\n\t\n\t/**\n\t * /demand/reason\n\t *\n\t * @param message\n\t * @param module\n\t * @param stack\n\t *\n\t * @constructor\n\t */\n\tfunction Reason(message, module, stack) {\n\t\tvar self = this;\n\t\t\n\t\tself.message = message;\n\t\t\n\t\tmodule && (self.module = module);\n\t\tstack && (self.stack = arrayPrototypeSlice.call(stack));\n\t}\n\t\n\tReason.prototype = {\n\t\t/* only for reference\n\t\t message: NULL,\n\t\t module:  NULL,\n\t\t stack:   NULL,\n\t\t */\n\t\ttoString: function() {\n\t\t\tvar self   = this,\n\t\t\t\tresult = DEMAND_ID + ': ' + self.message + ' ' + (self.module ? '\"' + self.module + '\"' : '');\n\t\t\t\n\t\t\tif(self.stack) {\n\t\t\t\tresult = Reason.traverse(self.stack, result, 1);\n\t\t\t}\n\t\t\t\n\t\t\treturn result;\n\t\t}\n\t};\n\t\n\tReason.traverse = function(stack, value, depth) {\n\t\tvar indention = new Array(depth + 1).join(' ');\n\t\t\n\t\tstack.forEach(function(item) {\n\t\t\tvalue += '\\n' + indention + '> ' + item.message + ' ' + (item.module ? '\"' + item.module + '\"' : '');\n\t\t\t\n\t\t\tif(item.stack) {\n\t\t\t\tvalue = Reason.traverse(item.stack, value, depth + 1);\n\t\t\t}\n\t\t});\n\t\t\n\t\treturn value;\n\t};\n\t\n\t/**\n\t * /demand/queue\n\t *\n\t * @constructor\n\t */\n\tfunction Queue() {\n\t\tvar self = this;\n\t\t\n\t\tself.items = 0;\n\t\tself.stack = [];\n\t}\n\t\n\tQueue.prototype = {\n\t\t/* only for reference\n\t\t items:   NULL,\n\t\t queue:   NULL,\n\t\t current: NULL,\n\t\t */\n\t\tadd: function() {\n\t\t\tqueue.stack  = queue.stack.concat(arrayPrototypeSlice.call(arguments));\n\t\t\tqueue.items += arguments.length;\n\t\t\t\n\t\t\t!queue.current && queue.process();\n\t\t},\n\t\tprocess: function() {\n\t\t\tvar current;\n\t\t\t\n\t\t\tif(queue.items) {\n\t\t\t\tqueue.items--;\n\t\t\t\t\n\t\t\t\tcurrent = queue.current = queue.stack.shift();\n\t\t\t\t\n\t\t\t\tcurrent.handler.process.call(current);\n\t\t\t\temit('postProcess', current);\n\t\t\t}\n\t\t}\n\t};\n\t\n\tfunction Loader(path, parameter) {\n\t\tvar self     = this,\n\t\t\tdeferred = Pledge.defer(),\n\t\t\tpledge   = deferred.pledge,\n\t\t\thandler  = parameter.handler,\n\t\t\txhr, timeout;\n\t\t\n\t\tself.deferred = deferred;\n\t\tself.path     = path;\n\t\tself.url      = parameter.url;\n\t\tself.cache    = parameter.cache;\n\t\tself.version  = parameter.version;\n\t\tself.lifetime = parameter.lifetime;\n\n\t\tdemand(MODULE_PREFIX_HANDLER + handler)\n\t\t\t.then(\n\t\t\t\tfunction(handler) {\n\t\t\t\t\tself.handler = handler;\n\t\t\t\t\tself.mock    = parameter.mock ? mocks[self.path] : NULL;\n\t\t\t\t\t\n\t\t\t\t\thandler.onPreRequest && handler.onPreRequest.call(self);\n\t\t\t\t\t\n\t\t\t\t\tif(!self.mock) {\n\t\t\t\t\t\tif(self.cache === false || !storage.get(self)) {\n\t\t\t\t\t\t\temit('preRequest', self);\n\n\t\t\t\t\t\t\tif(pledge.state === PLEDGE_PENDING) {\n\t\t\t\t\t\t\t\txhr = regexMatchBaseUrl.test(self.url) ? new XHR() : new XDR();\n\t\t\t\t\t\t\t\txhr.onprogress = function() {\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\txhr.ontimeout = xhr.onerror = xhr.onabort = function() {\n\t\t\t\t\t\t\t\t\tdeferred.reject(new Reason('timeout requesting', self.path));\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\txhr.onload = function() {\n\t\t\t\t\t\t\t\t\tvar type = xhr.getResponseHeader && xhr.getResponseHeader('content-type');\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\ttimeout = clearTimeout(timeout);\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif((!('status' in xhr) || xhr.status === 200) && (!type || !handler.matchType || handler.matchType.test(type))) {\n\t\t\t\t\t\t\t\t\t\tself.source = xhr.responseText;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\temit('postRequest', self);\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif(pledge.state === PLEDGE_PENDING) {\n\t\t\t\t\t\t\t\t\t\t\thandler.onPostRequest && handler.onPostRequest.call(self);\n\t\t\t\t\t\t\t\t\t\t\tresolve.loader(self);\n\n\t\t\t\t\t\t\t\t\t\t\tif(self.cache !== false) {\n\t\t\t\t\t\t\t\t\t\t\t\tpledge.then(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstorage.set(self);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tdeferred.reject(new Reason('error requesting', self.path));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\txhr.open('GET', self.url, true);\n\t\t\t\t\t\t\t\txhr.send();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\t\t\t\t\tif(xhr.readyState < 4) {\n\t\t\t\t\t\t\t\t\t\txhr.abort();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, settings.timeout);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tresolve.loader(self);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(self.mock.dependencies) {\n\t\t\t\t\t\t\tself.mock.dependencies.then(\n\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\tself.mock.resolve(self);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tself.mock.reject\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tself.mock.resolve(self);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdeferred.reject\n\t\t\t);\n\t\t\n\t\treturn deferred;\n\t}\n\t\n\t/* only for reference\n\t Loader.prototype = {\n\t deferred: NULL,\n\t path:     NULL,\n\t url:      NULL,\n\t handler:  NULL,\n\t source:   NULL,\n\t mock:     NULL,\n\t cache:    NULL,\n\t lifetime: NULL,\n\t version:  NULL,\n\t state:    { version: NULL, expires: NULL, url: NULL } // will only be set by storage\n\t };\n\t */\n\t\n\tregexMatchBaseUrl = createRegularExpression('^' + escapeRegularExpression(resolve.url('/')));\n\t\n\tconfigure({ cache: true, base: '/', pattern: { '/demand': resolve.url(((snippet && snippet.url) || location.href) + '/../').slice(0, -1)} });\n\tsnippet && snippet.settings && configure(snippet.settings);\n\t\n\tassign(MODULE_PREFIX + 'queue', (queue = new Queue()).add);\n\tassign(MODULE_PREFIX + 'mock', mock);\n\tassign(MODULE_PREFIX + 'pledge', Pledge);\n\tassign(MODULE_PREFIX + 'reason', Reason);\n\tassign(MODULE_PREFIX + 'function/resolveUrl', resolve.url);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isArray', isArray);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isObject', isObject);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isTypeOf', isTypeOf);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isInstanceOf', isInstanceOf);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isPositiveInteger', isPositiveInteger);\n\t\n\tdemand.configure = configure;\n\tdemand.remove    = remove;\n\tdemand.on        = on;\n\tdemand.list      = list;\n\tglobal.demand    = demand;\n\tglobal.provide   = provide;\n\t\n\t/**\n\t * /demand/handler/module\n\t */\n\t(function() {\n\t\tfunction definition() {\n\t\t\tvar target              = document.getElementsByTagName('head')[0],\n\t\t\t\tregexMatchSourcemap = /\\/\\/#\\s+sourceMappingURL\\s*=\\s*(?!(?:http[s]?:)?\\/\\/)(.+?)\\.map/g;\n\t\t\t\n\t\t\treturn {\n\t\t\t\tmatchType: /^(application|text)\\/(x-)?javascript/,\n\t\t\t\tonPreRequest: function() {\n\t\t\t\t\tvar self = this,\n\t\t\t\t\t\turl  = self.url;\n\t\t\t\t\t\n\t\t\t\t\tself.url = url.slice(-3) !== '.js' ? url + '.js' : url;\n\t\t\t\t},\n\t\t\t\tonPostRequest: function() {\n\t\t\t\t\tvar self   = this,\n\t\t\t\t\t\tsource = self.source,\n\t\t\t\t\t\tmatch, replacement;\n\t\t\t\t\t\n\t\t\t\t\tif(source) {\n\t\t\t\t\t\twhile(match = regexMatchSourcemap.exec(source)) {\n\t\t\t\t\t\t\tif(regexIsAbsolutePath.test(match[1])) {\n\t\t\t\t\t\t\t\tresolver.href = self.url;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treplacement = resolver.protocol + '//' + resolver.host + match[1];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treplacement = resolve.url(self.url + '/../' + match[1]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tsource = source.replace(match[0], '//# sourceMappingURL=' + replacement + '.map');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tself.source = source;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tprocess: function() {\n\t\t\t\t\tvar self   = this,\n\t\t\t\t\t\tsource = self.source,\n\t\t\t\t\t\tscript;\n\t\t\t\t\t\n\t\t\t\t\tif(source) {\n\t\t\t\t\t\tscript       = document.createElement('script');\n\t\t\t\t\t\tscript.async = true;\n\t\t\t\t\t\tscript.text  = source;\n\t\t\t\t\t\t\n\t\t\t\t\t\tscript.setAttribute('demand-path', self.path);\n\t\t\t\t\t\t\n\t\t\t\t\t\ttarget.appendChild(script);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\t\n\t\tprovide(MODULE_PREFIX_HANDLER + 'module', definition);\n\t}());\n\t\n\t/**\n\t * /demand/storage\n\t */\n\t(function(){\n\t\tfunction definition() {\n\t\t\tvar STORAGE_PREFIX       = '[' + DEMAND_ID + ']',\n\t\t\t\tSTORAGE_SUFFIX_STATE = '[state]',\n\t\t\t\tSTORAGE_SUFFIX_VALUE = '[value]',\n\t\t\t\tregexMatchState      = createRegularExpression('^' + escapeRegularExpression(STORAGE_PREFIX) + '\\\\[(.+?)\\\\]' + escapeRegularExpression(STORAGE_SUFFIX_STATE) + '$'),\n\t\t\t\tlocalStorage         = (function() { try { return 'localStorage' in global && global.localStorage; } catch(exception) { return false; } }()),\n\t\t\t\thasRemainingSpace    = localStorage && 'remainingSpace' in localStorage;\n\n\t\t\tfunction isEnabled(loader) {\n\t\t\t\tvar key, pointer, match;\n\n\t\t\t\tif(loader.cache !== NULL) {\n\t\t\t\t\treturn loader.cache;\n\t\t\t\t}\n\n\t\t\t\tfor(key in settings.cache) {\n\t\t\t\t\tpointer = settings.cache[key];\n\n\t\t\t\t\tif(loader.path.indexOf(key) === 0 && (!match || pointer.weight > match.weight)) {\n\t\t\t\t\t\tmatch = pointer;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn match ? match.state : false;\n\t\t\t}\n\t\t\t\n\t\t\tfunction Storage() {}\n\t\t\t\n\t\t\tStorage.prototype = {\n\t\t\t\tget: function(loader) {\n\t\t\t\t\tvar path = loader.path,\n\t\t\t\t\t\tid, state, pledge;\n\t\t\t\t\t\n\t\t\t\t\tif(localStorage && isEnabled(loader)) {\n\t\t\t\t\t\tid     = STORAGE_PREFIX + '[' + path + ']';\n\t\t\t\t\t\tstate  = JSON.parse(localStorage.getItem(id + STORAGE_SUFFIX_STATE));\n\t\t\t\t\t\tpledge = loader.deferred.pledge;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(state && state.version === loader.version && state.url === loader.url && ((!state.expires && !loader.lifetime) || state.expires > getTimestamp())) {\n\t\t\t\t\t\t\tpledge.cache  = 'hit';\n\t\t\t\t\t\t\tloader.source = localStorage.getItem(id + STORAGE_SUFFIX_VALUE);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\temit('cacheHit', loader);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\treturn loader.source;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpledge.cache = 'miss';\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\temit('cacheMiss', loader);\n\t\t\t\t\t\t\tthis.clear.path(path);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tset: function(loader) {\n\t\t\t\t\tvar path = loader.path,\n\t\t\t\t\t\tlifetime, id, spaceBefore;\n\n\t\t\t\t\tif(localStorage && isEnabled(loader)) {\n\t\t\t\t\t\temit('preCache', loader);\n\n\t\t\t\t\t\tlifetime = loader.lifetime;\n\t\t\t\t\t\tid       = STORAGE_PREFIX + '[' + path + ']';\n\t\t\t\t\t\t\n\t\t\t\t\t\tloader.state = { version: loader.version, expires: lifetime ? getTimestamp() + lifetime : lifetime, url: loader.url };\n\t\t\t\t\t\t\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tspaceBefore = hasRemainingSpace ? localStorage.remainingSpace : NULL;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlocalStorage.setItem(id + STORAGE_SUFFIX_VALUE, loader.source);\n\t\t\t\t\t\t\tlocalStorage.setItem(id + STORAGE_SUFFIX_STATE, JSON.stringify(loader.state));\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// strict equality check with \"===\" is required due to spaceBefore might be \"0\"\n\t\t\t\t\t\t\tif(spaceBefore !== NULL && localStorage.remainingSpace === spaceBefore) {\n\t\t\t\t\t\t\t\tthrow 'QUOTA_EXCEEDED_ERR';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\temit('postCache', loader);\n\t\t\t\t\t\t} catch(error) {\n\t\t\t\t\t\t\temit('cacheExceed', loader);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tclear: {\n\t\t\t\t\tpath: function(path) {\n\t\t\t\t\t\tvar id;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\t\tid = STORAGE_PREFIX + '[' + path + ']';\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlocalStorage.removeItem(id + STORAGE_SUFFIX_STATE);\n\t\t\t\t\t\t\tlocalStorage.removeItem(id + STORAGE_SUFFIX_VALUE);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\temit('cacheClear', path);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tall: function() {\n\t\t\t\t\t\tvar key, match;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\t\tfor(key in localStorage) {\n\t\t\t\t\t\t\t\tmatch = key.match(regexMatchState);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif(match) {\n\t\t\t\t\t\t\t\t\tthis.path(match[1]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\texpired: function() {\n\t\t\t\t\t\tvar key, match, state;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\t\tfor(key in localStorage) {\n\t\t\t\t\t\t\t\tmatch = key.match(regexMatchState);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif(match) {\n\t\t\t\t\t\t\t\t\tstate = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '[' + match[1] + ']' + STORAGE_SUFFIX_STATE));\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif(state && state.expires > 0 && state.expires <= getTimestamp()) {\n\t\t\t\t\t\t\t\t\t\tthis.path(match[1]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tstorage = new Storage();\n\t\t\tstorage.clear.expired();\n\t\t\t\n\t\t\tdemand.clear = storage.clear;\n\t\t\t\n\t\t\treturn storage;\n\t\t}\n\t\t\n\t\tprovide(MODULE_PREFIX_STORAGE, definition);\n\t}());\n\t\n\tif(snippet && snippet.main) {\n\t\tdemand(snippet.main);\n\t}\n}(this, document, JSON, XMLHttpRequest, setTimeout, clearTimeout, 'demand' in this && demand));"],"sourceRoot":"/source/"}