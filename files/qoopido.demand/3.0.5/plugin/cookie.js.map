{"version":3,"sources":["cookie.js","plugin/cookie.js"],"names":["document","definition","settings","isObject","isTypeOf","setCookie","path","value","expiration","cookie","encodeURIComponent","isEnabled","pointer","match","i","pattern","indexOf","weight","state","enabled","key","push","length","demand","on","item","loader","JSON","stringify","provide"],"mappings":"AAAA;AACA,CCWC,SAASA,GACT,YAEA,SAASC,GAAWC,EAAUC,EAAUC,GAYvC,QAASC,GAAUC,EAAMC,EAAOC,GAC/BR,EAASS,OAAS,UAAYH,EAAO,KAAOI,mBAAmBH,GAAS,aAAeC,EAAa,WAGrG,QAASG,GAAUL,GAGlB,IAFA,GAAWM,GAASC,EAAhBC,EAAI,EAEDF,EAAUG,EAAQD,GAAKA,IACQ,IAAlCR,EAAKU,QAAQJ,EAAQG,YAAoBF,GAASD,EAAQK,OAASJ,EAAMI,UAC3EJ,EAAQD,EAIV,OAAOC,GAAQA,EAAMK,OAAQ,EAxB9B,GACCC,GAASC,EADNL,IAGJ,IAAGZ,EAASD,GACX,IAAIkB,IAAOlB,GACVa,EAAQM,MAAON,QAASK,EAAKH,OAAQG,EAAIE,OAAQJ,MAAOhB,EAASkB,SAEzDhB,GAASF,EAAU,aAC5BiB,EAAUjB,EAiCX,OAdAqB,QACEC,GAAG,uBAAwB,SAASC,GACpCA,EAAuB,gBAATA,GAAoBA,EAAOA,EAAKnB,MAE3Ca,GAAWR,EAAUc,KACvBpB,EAAUoB,EAAM,GAAI,mCAGrBD,GAAG,YAAa,SAASE,IACtBP,GAAWR,EAAUe,EAAOpB,QAC9BD,EAAUqB,EAAOpB,KAAMqB,KAAKC,UAAUF,EAAOR,OAAQ,oCAIjD,EAGRW,SAAU,WAAY,6BAA8B,8BAAgC5B,IACnFD","file":"plugin/cookie.js","sourcesContent":[null,"/**\n * Qoopido.demand plugin/cookie\n *\n * Copyright (c) 2016 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(document) {\n\t'use strict';\n\n\tfunction definition(settings, isObject, isTypeOf) {\n\t\tvar pattern = [],\n\t\t\tenabled, key;\n\n\t\tif(isObject(settings)) {\n\t\t\tfor(key in settings) {\n\t\t\t\tpattern.push({ pattern: key, weight: key.length, state: settings[key] });\n\t\t\t}\n\t\t} else if(isTypeOf(settings, 'boolean')) {\n\t\t\tenabled = settings;\n\t\t}\n\n\t\tfunction setCookie(path, value, expiration) {\n\t\t\tdocument.cookie = 'demand[' + path + ']=' + encodeURIComponent(value) + '; expires=' + expiration + '; path=/';\n\t\t}\n\n\t\tfunction isEnabled(path) {\n\t\t\tvar i = 0, pointer, match;\n\n\t\t\tfor(; (pointer = pattern[i]); i++) {\n\t\t\t\tif(path.indexOf(pointer.pattern) === 0 && (!match || pointer.weight > match.weight)) {\n\t\t\t\t\tmatch = pointer;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn match ? match.state : false;\n\t\t}\n\n\t\tdemand\n\t\t\t.on('cacheMiss cacheClear', function(item) {\n\t\t\t\titem = typeof item === 'string' ? item : item.path;\n\n\t\t\t\tif(enabled || isEnabled(item)) {\n\t\t\t\t\tsetCookie(item, '', 'Thu, 01 Jan 1970 00:00:00 GMT');\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on('postCache', function(loader) {\n\t\t\t\tif(enabled || isEnabled(loader.path)) {\n\t\t\t\t\tsetCookie(loader.path, JSON.stringify(loader.state), 'Fri, 31 Dec 9999 23:59:59 GMT');\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn true;\n\t}\n\n\tprovide([ 'settings', '/demand/validator/isObject', '/demand/validator/isTypeOf' ], definition);\n}(document));"],"sourceRoot":"/source/"}