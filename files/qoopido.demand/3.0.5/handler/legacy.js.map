{"version":3,"sources":["legacy.js","handler/legacy.js"],"names":["setTimeout","definition","Reason","handlerModule","settings","finalize","deferred","result","self","this","probe","path","process","call","pledge","state","provide","reject","matchType","onPreRequest","dependencies","demand","apply","then","arguments","mock","onPostRequest","resolve","bind"],"mappings":"AAAA;AACA,CCWC,SAASA,GACT,YAEA,SAASC,GAAWC,EAAQC,EAAeC,GAC1C,QAASC,KACR,GAECC,GAAUC,EAFPC,EAAQC,KACXC,EAAQN,EAASI,EAAKG,OAASP,EAASI,EAAKG,MAAMD,KAGpDP,GAAcS,QAAQC,KAAKL,GAExBE,GACFV,EAAW,WACVM,EAAWE,EAAKF,SAEa,YAA1BA,EAASQ,OAAOC,SACfR,EAASG,KACXM,QAAQ,WAAa,MAAOT,KAE5BD,EAASW,OAAO,GAAIf,GAAO,gBAAiBM,EAAKG,UAOtD,OACCO,UAAef,EAAce,UAC7BC,aAAe,WACd,GAAIX,GAAeC,KAClBH,EAAeE,EAAKF,SACpBc,EAAehB,EAASI,EAAKG,OAASP,EAASI,EAAKG,MAAMS,YAExDA,KACFZ,EAAKY,aAAeA,EAAeC,OACjCC,MAAM,KAAMF,GACZG,KACA,KACA,WACCjB,EAASW,OAAO,GAAIf,GAAO,kBAAmBM,EAAKG,KAAMa,eAK1DJ,GAAgBZ,EAAKiB,OACvBjB,EAAKiB,KAAKL,aAAeA,GAG1BjB,EAAcgB,aAAaN,KAAKJ,OAEjCiB,cAAevB,EAAcuB,cAC7Bd,QAAS,WACR,GAAIJ,GAAUC,KACbkB,EAAUtB,EAASuB,KAAKpB,EAEtBA,GAAKY,aACPZ,EAAKY,aAAaG,KACjBI,EACAnB,EAAKF,SAASW,QAGfU,MAMJX,SAAU,iBAAkB,yBAA0B,YAAcf,IACnED","file":"handler/legacy.js","sourcesContent":["/**\n * Qoopido demand - legacy polyfills\n *\n * Polyfills required to provide IE8 compatibility\n *\n * Copyright (c) 2016 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(functionPrototype, objectPrototype, arrayPrototype, undefined) {\n\t'use strict';\n\n\tvar arrayPrototypeSlice = arrayPrototype.slice,\n\t\tNULL                = null,\n\t\tSTRING_FUNCTION     = 'function';\n\n\tfunction isTypeOf(object, type) {\n\t\treturn typeof object === type;\n\t}\n\n\tfunction isObject(object) {\n\t\treturn object && isTypeOf(object, 'object');\n\t}\n\n\tif(!functionPrototype.bind) {\n\t\tfunctionPrototype.bind = function(context) {\n\t\t\tvar self = this,\n\t\t\t\tparameter, target, Constructor, bound;\n\n\t\t\tif(isTypeOf(self, STRING_FUNCTION)) {\n\t\t\t\tparameter   = arrayPrototypeSlice.call(arguments, 1);\n\t\t\t\ttarget      = self;\n\t\t\t\tConstructor = function() {};\n\t\t\t\tbound       = function() {\n\t\t\t\t\treturn target.apply(self instanceof Constructor ? self : context, parameter.concat(arrayPrototypeSlice.call(arguments)));\n\t\t\t\t};\n\n\t\t\t\tConstructor.prototype = self.prototype;\n\t\t\t\tbound.prototype       = new Constructor();\n\n\t\t\t\treturn bound;\n\t\t\t} else {\n\t\t\t\tthrow new TypeError('Function.prototype.bind - what is trying to be bound is not callable');\n\t\t\t}\n\t\t};\n\t}\n\n\tif(!Object.keys) {\n\t\tObject.keys = (function() {\n\t\t\tvar hasOwnProperty = objectPrototype.hasOwnProperty,\n\t\t\t\thasEnumBug     = !({ toString: NULL }).propertyIsEnumerable('toString'),\n\t\t\t\tproperties     = [ 'toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor' ];\n\n\t\t\treturn function(object) {\n\t\t\t\tvar keys = [],\n\t\t\t\t\ti = 0, property;\n\n\t\t\t\tif(!isObject(object) && !isTypeOf(object, STRING_FUNCTION)) {\n\t\t\t\t\tthrow new TypeError('Object.keys called on non-object');\n\t\t\t\t}\n\n\t\t\t\tfor(property in object) {\n\t\t\t\t\tif(hasOwnProperty.call(object, property)) {\n\t\t\t\t\t\tkeys.push(property);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif(hasEnumBug) {\n\t\t\t\t\tfor(; (property = properties[i]) !== undefined; i++) {\n\t\t\t\t\t\tif(hasOwnProperty.call(object, property)) {\n\t\t\t\t\t\t\tkeys.push(property);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn keys;\n\t\t\t};\n\t\t}());\n\t}\n}(Function.prototype, Object.prototype, Array.prototype));","/**\n * Qoopido.demand handler/legacy\n *\n * Copyright (c) 2016 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(setTimeout) {\n\t'use strict';\n\n\tfunction definition(Reason, handlerModule, settings) {\n\t\tfunction finalize() {\n\t\t\tvar self  = this,\n\t\t\t\tprobe = settings[self.path] && settings[self.path].probe,\n\t\t\t\tdeferred, result;\n\n\t\t\thandlerModule.process.call(self);\n\n\t\t\tif(probe) {\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tdeferred = self.deferred;\n\n\t\t\t\t\tif(deferred.pledge.state === 'pending') {\n\t\t\t\t\t\tif(result = probe()) {\n\t\t\t\t\t\t\tprovide(function() { return result; });\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdeferred.reject(new Reason('error probing', self.path));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tmatchType:     handlerModule.matchType,\n\t\t\tonPreRequest:  function() {\n\t\t\t\tvar self         = this,\n\t\t\t\t\tdeferred     = self.deferred,\n\t\t\t\t\tdependencies = settings[self.path] && settings[self.path].dependencies;\n\n\t\t\t\tif(dependencies) {\n\t\t\t\t\tself.dependencies = dependencies = demand\n\t\t\t\t\t\t.apply(null, dependencies)\n\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tdeferred.reject(new Reason('error resolving', self.path, arguments));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif(dependencies && self.mock) {\n\t\t\t\t\tself.mock.dependencies = dependencies;\n\t\t\t\t}\n\n\t\t\t\thandlerModule.onPreRequest.call(this);\n\t\t\t},\n\t\t\tonPostRequest: handlerModule.onPostRequest,\n\t\t\tprocess: function() {\n\t\t\t\tvar self    = this,\n\t\t\t\t\tresolve = finalize.bind(self);\n\n\t\t\t\tif(self.dependencies) {\n\t\t\t\t\tself.dependencies.then(\n\t\t\t\t\t\tresolve,\n\t\t\t\t\t\tself.deferred.reject\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tprovide([ '/demand/reason', '/demand/handler/module', 'settings' ], definition);\n}(setTimeout));"],"sourceRoot":"/source/"}