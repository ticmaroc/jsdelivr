{"version":3,"sources":["css.js","handler/css.js"],"names":["document","setTimeout","resolveUrl","url","resolver","href","definition","matchType","onPreRequest","self","this","slice","onPostRequest","match","base","host","source","regexMatchUrl","exec","regexIsAbsoluteUri","test","replace","regexIsAbsolutePath","regexMatchImport","process","element","querySelector","path","createElement","type","setAttribute","target","appendChild","tagName","styleSheet","cssText","textContent","provide","getElementsByTagName"],"mappings":"AAAA;AACA,CCWC,SAASA,EAAUC,GACnB,YASA,SAASC,GAAWC,GAGnB,MAFAC,GAASC,KAAOF,EAETC,EAGR,QAASE,KACR,OACCC,UAAW,aACXC,aAAc,WACb,GAAIC,GAAOC,KACVP,EAAOM,EAAKN,GAEbM,GAAKN,IAAwB,SAAlBA,EAAIQ,MAAM,IAAiBR,EAAM,OAASA,GAEtDS,cAAe,WAQd,IAPA,GAKCC,GALGJ,EAAUC,KACbP,EAAUD,EAAWO,EAAKN,IAAM,OAChCW,EAAUX,EAAIE,KACdU,EAAU,KAAOZ,EAAIY,KACrBC,EAAUP,EAAKO,OAGTH,EAAQI,EAAcC,KAAKF,IAC7BG,EAAmBC,KAAKP,EAAM,MACjCG,EAASA,EAAOK,QAAQR,EAAM,GAAI,QAAUX,EAAWoB,EAAoBF,KAAKP,EAAM,IAAME,EAAOF,EAAM,GAAKC,EAAOD,EAAM,IAAIR,KAAO,MAIxI,MAAOQ,EAAQU,EAAiBL,KAAKF,IAChCG,EAAmBC,KAAKP,EAAM,MACjCG,EAASA,EAAOK,QAAQR,EAAM,GAAI,YAAcX,EAAWoB,EAAoBF,KAAKP,EAAM,IAAME,EAAOF,EAAM,GAAKC,EAAOD,EAAM,IAAIR,KAAO,KAI5II,GAAKO,OAASA,GAEfQ,QAAS,WACR,GAAIf,GAAUC,KACbe,EAAUzB,EAAS0B,cAAc,iBAAmBjB,EAAKkB,KAAO,MAChEX,EAAUP,EAAKO,MAEZS,KACHA,EAAezB,EAAS4B,cAAc,SACtCH,EAAQI,KAAO,WAEfJ,EAAQK,aAAa,cAAerB,EAAKkB,MACzCI,EAAOC,YAAYP,IAGG,UAApBA,EAAQQ,UACPR,EAAQS,WACVT,EAAQS,WAAWC,QAAUnB,EAE7BS,EAAQW,YAAcpB,GAIxBf,EAAW,WACVoC,QAAQ,WAAa,MAAOZ,SAlEhC,GAAIM,GAAsB/B,EAASsC,qBAAqB,QAAQ,GAC/DlC,EAAsBJ,EAAS4B,cAAc,KAC7CX,EAAsB,oCACtBM,EAAsB,4BACtBD,EAAsB,OACtBH,EAAsB,wBAmEvBkB,SAAQ/B,IACPN,SAAUC","file":"handler/css.js","sourcesContent":[null,"/**\n * Qoopido.demand handler/css\n *\n * Copyright (c) 2016 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(document, setTimeout) {\n\t'use strict';\n\n\tvar target              = document.getElementsByTagName('head')[0],\n\t\tresolver            = document.createElement('a'),\n\t\tregexMatchUrl       = /url\\s*\\(\\s*[\"']?(.+?)[\"']?\\s*\\)/gi,\n\t\tregexMatchImport    = /@import\\s+[\"'](.+?)[\"']/gi,\n\t\tregexIsAbsolutePath = /^\\//i,\n\t\tregexIsAbsoluteUri  = /^data:|http(s?):|\\/\\//i;\n\n\tfunction resolveUrl(url) {\n\t\tresolver.href = url;\n\n\t\treturn resolver;\n\t}\n\n\tfunction definition() {\n\t\treturn {\n\t\t\tmatchType: /^text\\/css/,\n\t\t\tonPreRequest: function() {\n\t\t\t\tvar self = this,\n\t\t\t\t\turl  = self.url;\n\n\t\t\t\tself.url = url.slice(-4) !== '.css' ? url + '.css' : url;\n\t\t\t},\n\t\t\tonPostRequest: function() {\n\t\t\t\tvar self    = this,\n\t\t\t\t\turl     = resolveUrl(self.url + '/..'),\n\t\t\t\t\tbase    = url.href,\n\t\t\t\t\thost    = '//' + url.host,\n\t\t\t\t\tsource  = self.source,\n\t\t\t\t\tmatch;\n\n\t\t\t\twhile((match = regexMatchUrl.exec(source))) {\n\t\t\t\t\tif(!regexIsAbsoluteUri.test(match[1])) {\n\t\t\t\t\t\tsource = source.replace(match[0], 'url(\"' + resolveUrl(regexIsAbsolutePath.test(match[1]) ? host + match[1] : base + match[1]).href + '\")');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twhile((match = regexMatchImport.exec(source))) {\n\t\t\t\t\tif(!regexIsAbsoluteUri.test(match[1])) {\n\t\t\t\t\t\tsource = source.replace(match[0], '@import \"' + resolveUrl(regexIsAbsolutePath.test(match[1]) ? host + match[1] : base + match[1]).href + '\"');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tself.source = source;\n\t\t\t},\n\t\t\tprocess: function() {\n\t\t\t\tvar self    = this,\n\t\t\t\t\telement = document.querySelector('[demand-path=\"' + self.path + '\"]'),\n\t\t\t\t\tsource  = self.source;\n\n\t\t\t\tif(!element) {\n\t\t\t\t\telement      = document.createElement('style');\n\t\t\t\t\telement.type = 'text/css';\n\n\t\t\t\t\telement.setAttribute('demand-path', self.path);\n\t\t\t\t\ttarget.appendChild(element);\n\t\t\t\t}\n\n\t\t\t\tif(element.tagName === 'STYLE') {\n\t\t\t\t\tif(element.styleSheet) {\n\t\t\t\t\t\telement.styleSheet.cssText = source;\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.textContent = source;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tprovide(function() { return element; });\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\tprovide(definition);\n}(document, setTimeout));"],"sourceRoot":"/source/"}