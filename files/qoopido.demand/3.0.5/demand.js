/*! Qoopido.demand 3.0.5 | https://github.com/dlueth/qoopido.demand | (c) 2016 Dirk Lueth */
!function(e,t,r,n,c,o,i,a,s,u){"use strict";function l(e){var t,r,n,c=he[e];if(c)for(t=$.call(arguments,1),r=0;n=c[r];r++)n.apply(te,t)}function f(e){R(console,"undefined")||console.error(e.toString())}function p(e,t){C(e,function(){return t})}function h(e){return e.replace(ae,"\\$&")}function d(e,t){return new RegExp(e,t)}function m(){return+new Date}function v(e,t){return e=e.replace(ie,""),ne.test(e)||ce.test(e)||(e="/"+P((t&&P(t+"/../")||"/")+e).replace(A,"")),e}function g(e,t){var r,n,c=R(e,Y)?v(e,t):te;if(c){if(t&&(e===L||e===N||e===_)){switch(e){case L:c=J+c,r=function(){var e,r=O.bind(t);for(e in O)r[e]=O[e];return r};break;case N:c=J+c,r=function(){return C.bind(t)};break;case _:c=Q+t,r=function(){return ue.modules[t]||te}}!fe[c]&&C(c,r)}return(fe[c]||(fe[c]=new S(c,y(e,t)))).pledge}return n=T.defer(),n.resolve(e),n.pledge}function y(e,t){var r,n,c=e.match(ie),o=ue.pattern;if(e=v(e,t),!ce.test(e))for(r in o)o[r].matches(e)&&(!n||n.weight<o[r].weight)&&(n=o[r]);return{mock:!(!c||!c[1]),cache:c&&c[2]?"+"===c[2]:te,handler:c&&c[3]||ue.handler,version:c&&c[4]||ue.version,lifetime:c&&c[5]&&1e3*c[5]||ue.lifetime,url:n?P(n.process(e)):e}}function w(e){var t=e.handler;l("preProcess",e),e.deferred.pledge.state===K&&(t.onPreProcess&&t.onPreProcess.call(e),t.process&&H.add(e))}function k(e){return"[object Array]"===X.call(e)}function j(e){return e&&R(e,"object")}function R(e,t){return typeof e===t}function b(e,t){return e instanceof t}function x(e){return R(e,"number")&&isFinite(e)&&Math.floor(e)===e&&e>=0}function P(e){return le.href=e,le.href}function q(e){for(var t,r,n,c=[],o=0;t=e[o];o++)n=t.match(ie),t=t.replace(ie,""),e[o]=(n?"mock:"+n.slice(1).join(""):"mock:")+"!"+t,r=(pe[t]=T.defer()).pledge,r.then(function(e){delete pe[e.path]}),c.push(r);return O.apply(te,e),T.all(c)}function E(e,t){var r=this;r.weight=e.length,r.url=P(t).replace(oe,"$1"),r.matchPattern=d("^"+h(e)),r.matchUrl=d("^"+h(t))}function S(e,t){var r,n,i=this,a=T.defer(),s=a.pledge,f=t.handler;return i.deferred=a,i.path=e,i.url=t.url,i.cache=t.cache,i.version=t.version,i.lifetime=t.lifetime,O(G+f).then(function(e){i.handler=e,i.mock=t.mock?pe[i.path]:te,e.onPreRequest&&e.onPreRequest.call(i),i.mock?i.mock.dependencies?i.mock.dependencies.then(function(){i.mock.resolve(i)},i.mock.reject):i.mock.resolve(i):i.cache!==!1&&U.get(i)?c(function(){w(i)}):(l("preRequest",i),s.state===K&&(r=A.test(i.url)?new u:new re,r.onprogress=function(){},r.ontimeout=r.onerror=r.onabort=function(){a.reject(new I("timeout requesting",i.path))},r.onload=function(){var t=r.getResponseHeader&&r.getResponseHeader("content-type");n=o(n),"status"in r&&200!==r.status||t&&e.matchType&&!e.matchType.test(t)?a.reject(new I("error requesting",i.path)):(i.source=r.responseText,l("postRequest",i),s.state===K&&(e.onPostRequest&&e.onPostRequest.call(i),w(i),i.cache!==!1&&s.then(function(){U.set(i)})))},r.open("GET",i.url,!0),r.send(),n=c(function(){r.readyState<4&&r.abort()},ue.timeout)))},a.reject),a}function T(e){function t(){n(V,arguments)}function r(){n(W,arguments)}function n(e,t){var r,n;if(c.state===K){for(c.state=e,c.value=t;r=o[e].shift();)n=r.handler.apply(te,t),n&&"function"==typeof n.then?n.then(r.deferred.resolve,r.deferred.reject):r.deferred.resolve(n);o=te}}var c=this,o={resolved:[],rejected:[]};c.then=function(e,t){var r=T.defer();if(c.state===K)e&&o[V].push({handler:e,deferred:r}),t&&o[W].push({handler:t,deferred:r});else switch(c.state){case V:r.resolve(e&&e.apply(te,c.value));break;case W:r.reject(t&&t.apply(te,c.value))}return r.pledge},e(t,r)}function I(e,t,r){this.message=e,t&&(this.module=t),r&&(this.stack=$.call(r))}function M(){this.items=0,this.stack=[]}function O(){for(var e,t=$.call(arguments),r=0;e=t[r];r++)t[r]=g(e,this!==window?this:te);return T.all(t)}function C(){var e,t,r,n=arguments,c=R(n[0],Y)?n[0]:te,o=k(n[c?1:0])?n[c?1:0]:te,i=o?n[c?2:1]:n[c?1:0];if(!c&&H.current&&(c=H.current.path,H.current=te,H.items>0&&H.process()),!c)throw"unspecified anonymous provide";c=v(c,this),e=fe[c]||(fe[c]=T.defer()),t=e.pledge,r=R(i,ee),t.state===K&&(o?O.apply(c,o).then(function(){e.resolve(r?i.apply(te,arguments):i)},function(){f(new I("error providing",c,arguments))}):e.resolve(r?i():i))}var A,H,U,$=a.slice,D=a.concat,X=s.toString,L="demand",N="provide",_="settings",B="/"+L+"/",F=B+"storage/",G=B+"handler/",J=B+"local",Q=B+"settings",z=B+"validator/",K="pending",V="resolved",W="rejected",Y="string",Z="boolean",ee="function",te=null,re="XDomainRequest"in e&&e.XDomainRequest||u,ne=/^\//,ce=/^(http(s?):)?\/\//i,oe=/(.+)\/$/,ie=/^(mock:)?([+-])?((?:[-\w]+\/?)+)?(?:@(\d+\.\d+.\d+))?(?:#(\d+))?!/,ae=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,se=/^cache(Miss|Hit|Clear|Exceed)|(pre|post)(Request|Process|Cache)$/,ue={cache:{},timeout:8e3,pattern:{},modules:{},handler:"module"},le=t.createElement("a"),fe={},pe={},he={};E.prototype={matches:function(e){return this.matchPattern.test(e)},remove:function(e){return e.replace(this.matchUrl,"")},process:function(e){return e.replace(this.matchPattern,this.url)}},T.prototype={state:K},T.defer=function(){var e={};return e.pledge=new T(function(t,r){e.resolve=t,e.reject=r}),e},T.all=function(e){function t(e,t){t.then(function(){o[e]=$.call(arguments),s++,r()},function(){i.push($.call(arguments)),r()})}function r(){s===a?c.resolve.apply(te,D.apply([],o)):i.length+s===a&&c.reject.apply(te,D.apply([],i))}for(var n,c=T.defer(),o=[],i=[],a=e.length,s=0,u=0;n=e[u];u++)t(u,n);return c.pledge},T.race=function(e){for(var t,r=T.defer(),n=0;t=e[n];n++)t.then(r.resolve,r.reject);return r.pledge},I.prototype={toString:function(){var e=this,t=L+": "+e.message+" "+(e.module?'"'+e.module+'"':"");return e.stack&&(t=I.traverse(e.stack,t,1)),t}},I.traverse=function(e,t,r){for(var n,c=new Array(r+1).join(" "),o=0;n=e[o];o++)t+="\n"+c+"> "+n.message+" "+(n.module?'"'+n.module+'"':""),n.stack&&(t=I.traverse(n.stack,t,r+1));return t},M.prototype={add:function(){H.stack=H.stack.concat($.call(arguments)),H.items+=arguments.length,!H.current&&H.process()},process:function(){var e;H.items&&(H.items--,e=H.current=H.stack.shift(),e.handler.process.call(e),l("postProcess",e))}},O.configure=function(e){var t,r=e.cache,n=e.version,c=e.timeout,o=e.lifetime,i=e.base,a=e.pattern,s=e.modules,u=ue.modules;if(R(r,Z))ue.cache[""]={weight:0,state:r};else if(j(r))for(t in r)ue.cache[t]={weight:t.length,state:r[t]};if(R(n,Y)&&(ue.version=n),x(c)&&(ue.timeout=1e3*Math.min(Math.max(c,2),12)),x(o)&&o>0&&(ue.lifetime=1e3*o),R(i,Y)&&""!==i&&(ue.pattern.base=new E("",i)),j(a))for(t in a)"base"!==t&&(ue.pattern[t]=new E(t,a[t]));if(j(s))for(t in s)t!==F&&(u[t]=s[t])},O.remove=function(e){fe[e]&&(!!fe[e].cache&&U.clean.path(e),delete fe[e],delete pe[e])},O.on=function(e,t){var r;if(R(e,Y)&&R(t,ee))for(e=e.split(" ");r=e.shift();)se.test(r)&&(he[r]||(he[r]=[])).push(t);return O},O.list=function(e){var t,r,n;if(e){t=[];for(r in fe)n=fe[r].pledge,n.state!==e&&n.cache!==e||t.push(r)}else t=Object.keys(fe);return t},function(){function e(){var e=t.getElementsByTagName("head")[0],r=/\/\/#\s+sourceMappingURL\s*=\s*(?!(?:http[s]?:)?\/\/)(.+?)\.map/g;return{matchType:/^(application|text)\/(x-)?javascript/,onPreRequest:function(){var e=this.url;this.url=".js"!==e.slice(-3)?e+".js":e},onPostRequest:function(){var e,t,n=this,c=n.source;if(c){for(;e=r.exec(c);)ne.test(e[1])?(le.href=n.url,t=le.protocol+"//"+le.host+e[1]):t=P(n.url+"/../"+e[1]),c=c.replace(e[0],"//# sourceMappingURL="+t+".map");n.source=c}},process:function(){var r,n=this.source;n&&(r=t.createElement("script"),r.async=!0,r.text=n,r.setAttribute("demand-path",this.path),e.appendChild(r))}}}C(G+"module",e)}(),function(){function t(){function t(e){var t,r,n;if(e.cache!==te)return e.cache;for(t in ue.cache)r=ue.cache[t],0===e.path.indexOf(t)&&(!n||r.weight>n.weight)&&(n=r);return n?n.state:!1}function n(){this.clear.expired()}var c="["+L+"]",o="[state]",i="[value]",a=d("^"+h(c)+"\\[(.+?)\\]"+h(o)+"$"),s=function(){try{return"localStorage"in e&&e.localStorage}catch(t){return!1}}(),u=s&&"remainingSpace"in s;return n.prototype={get:function(e){var n,a,u,f=e.path;if(s&&t(e)){if(n=c+"["+f+"]",a=r.parse(s.getItem(n+o)),u=e.deferred.pledge,a&&a.version===e.version&&a.url===e.url&&(!a.expires&&!e.lifetime||a.expires>m()))return u.cache="hit",e.source=s.getItem(n+i),l("cacheHit",e),e.source;u.cache="miss",l("cacheMiss",e),this.clear.path(f)}},set:function(e){var n,a,f,p=e.path;if(s&&t(e)){l("preCache",e),n=e.lifetime,a=c+"["+p+"]",e.state={version:e.version,expires:n?m()+n:n,url:e.url};try{if(f=u?s.remainingSpace:te,s.setItem(a+i,e.source),s.setItem(a+o,r.stringify(e.state)),f!==te&&s.remainingSpace===f)throw"QUOTA_EXCEEDED_ERR";l("postCache",e)}catch(h){l("cacheExceed",e)}}},clear:{path:function(e){var t;s&&(t=c+"["+e+"]",s.removeItem(t+o),s.removeItem(t+i),l("cacheClear",e))},all:function(){var e,t;if(s)for(e in s)t=e.match(a),t&&this.path(t[1])},expired:function(){var e,t,n;if(s)for(e in s)t=e.match(a),t&&(n=r.parse(s.getItem(c+"["+t[1]+"]"+o)),n&&n.expires>0&&n.expires<=m()&&this.path(t[1]))}}},O.clear=(U=new n).clear,U}C(F,t)}(),A=d("^"+h(P("/"))),O.configure({cache:!0,base:"/",pattern:{"/demand":P((i&&i.url||location.href)+"/../").slice(0,-1)}}),i&&i.settings&&O.configure(i.settings),p(z+"isArray",k),p(z+"isObject",j),p(z+"isTypeOf",R),p(z+"isInstanceOf",b),p(z+"isPositiveInteger",x),p(B+"function/resolveUrl",P),p(B+"mock",q),p(B+"queue",(H=new M).add),p(B+"pledge",T),p(B+"reason",I),e.demand=O,e.provide=C,i&&i.main&&O(i.main)}(this,document,JSON,XMLHttpRequest,setTimeout,clearTimeout,"demand"in this&&demand,Array.prototype,Object.prototype,XMLHttpRequest);
//# sourceMappingURL=demand.js.map
