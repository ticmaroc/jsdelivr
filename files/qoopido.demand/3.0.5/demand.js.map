{"version":3,"sources":["demand.js"],"names":["global","document","JSON","XMLHttpRequest","setTimeout","clearTimeout","snippet","arrayPrototype","objectPrototype","XHR","emit","event","parameter","i","callback","pointer","listener","arrayPrototypeSlice","call","arguments","apply","NULL","log","error","isTypeOf","console","toString","assign","id","factory","provide","escapeRegularExpression","value","replace","regexMatchRegex","createRegularExpression","expression","modifier","RegExp","getTimestamp","Date","resolvePath","path","context","regexMatchParameter","regexIsAbsolutePath","test","regexIsAbsoluteUri","resolveUrl","regexMatchBaseUrl","resolveDependency","dependency","definition","deferred","STRING_STRING","DEMAND_ID","PROVIDE_ID","SETTINGS_ID","MODULE_PREFIX_LOCAL","key","scopedDemand","demand","bind","MODULE_PREFIX_SETTINGS","settings","modules","registry","Loader","resolveParameter","pledge","Pledge","defer","resolve","match","pattern","matches","weight","mock","cache","handler","version","lifetime","url","process","resolveLoader","loader","state","PLEDGE_PENDING","onPreProcess","queue","add","isArray","objectPrototypeToString","isObject","object","type","isInstanceOf","module","isPositiveInteger","isFinite","Math","floor","resolver","href","pledges","slice","join","mocks","then","push","all","Pattern","self","this","length","regexMatchTrailingSlash","matchPattern","matchUrl","xhr","timeout","MODULE_PREFIX_HANDLER","onPreRequest","dependencies","reject","storage","get","XDR","onprogress","ontimeout","onerror","onabort","Reason","onload","getResponseHeader","status","matchType","source","responseText","onPostRequest","set","open","send","readyState","abort","executor","handle","PLEDGE_RESOLVED","PLEDGE_REJECTED","aState","aParameter","result","shift","resolved","rejected","aResolved","aRejected","message","stack","Queue","items","window","isFunction","current","STRING_FUNCTION","arrayPrototypeConcat","concat","MODULE_PREFIX","MODULE_PREFIX_STORAGE","MODULE_PREFIX_VALIDATOR","STRING_BOOLEAN","XDomainRequest","regexMatchEvent","createElement","prototype","remove","aResolve","aReject","observePledge","index","countResolved","checkState","countTotal","race","traverse","depth","item","indention","Array","configure","base","min","max","clean","on","events","split","list","keys","Object","target","getElementsByTagName","regexMatchSourcemap","replacement","exec","protocol","host","script","async","text","setAttribute","appendChild","isEnabled","indexOf","Storage","clear","expired","STORAGE_PREFIX","STORAGE_SUFFIX_STATE","STORAGE_SUFFIX_VALUE","regexMatchState","localStorage","exception","hasRemainingSpace","parse","getItem","expires","spaceBefore","remainingSpace","setItem","stringify","removeItem","/demand","location","main"],"mappings":"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","file":"demand.js","sourcesContent":["/**\n * Qoopido demand\n *\n * Promise like module loader (XHR) with localStorage caching\n *\n * Copyright (c) 2016 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(global, document, JSON, XMLHttpRequest, setTimeout, clearTimeout, snippet, arrayPrototype, objectPrototype, XHR) {\n\t'use strict';\n\t\n\tvar /** pointer */\n\t\t\tarrayPrototypeSlice     = arrayPrototype.slice,\n\t\t\tarrayPrototypeConcat    = arrayPrototype.concat,\n\t\t\tobjectPrototypeToString = objectPrototype.toString,\n\t\t/** constants */\n\t\t\tDEMAND_ID               = 'demand',\n\t\t\tPROVIDE_ID              = 'provide',\n\t\t\tSETTINGS_ID             = 'settings',\n\t\t\tMODULE_PREFIX           = '/' + DEMAND_ID + '/',\n\t\t\tMODULE_PREFIX_STORAGE   = MODULE_PREFIX + 'storage/',\n\t\t\tMODULE_PREFIX_HANDLER   = MODULE_PREFIX + 'handler/',\n\t\t\tMODULE_PREFIX_LOCAL     = MODULE_PREFIX + 'local',\n\t\t\tMODULE_PREFIX_SETTINGS  = MODULE_PREFIX + 'settings',\n\t\t\tMODULE_PREFIX_VALIDATOR = MODULE_PREFIX + 'validator/',\n\t\t\tPLEDGE_PENDING          = 'pending',\n\t\t\tPLEDGE_RESOLVED         = 'resolved',\n\t\t\tPLEDGE_REJECTED         = 'rejected',\n\t\t\tSTRING_STRING           = 'string',\n\t\t\tSTRING_BOOLEAN          = 'boolean',\n\t\t\tSTRING_FUNCTION         = 'function',\n\t\t\tNULL                    = null,\n\t\t\tXDR                     = 'XDomainRequest' in global &&  global.XDomainRequest || XHR,\n\t\t/** regular expressions */\n\t\t\tregexIsAbsolutePath     = /^\\//,\n\t\t\tregexIsAbsoluteUri      = /^(http(s?):)?\\/\\//i,\n\t\t\tregexMatchTrailingSlash = /(.+)\\/$/,\n\t\t\tregexMatchParameter     = /^(mock:)?([+-])?((?:[-\\w]+\\/?)+)?(?:@(\\d+\\.\\d+.\\d+))?(?:#(\\d+))?!/,\n\t\t\tregexMatchRegex         = /[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g,\n\t\t\tregexMatchEvent         = /^cache(Miss|Hit|Clear|Exceed)|(pre|post)(Request|Process|Cache)$/,\n\t\t/** other */\n\t\t\tsettings                = { cache: {}, timeout: 8 * 1000, pattern: {}, modules: {}, handler: 'module' },\n\t\t\tresolver                = document.createElement('a'),\n\t\t\tregistry                = {},\n\t\t\tmocks                   = {},\n\t\t\tlistener                = {},\n\t\t\tregexMatchBaseUrl, queue, storage;\n\n\t/**\n\t * --------------------------------\n\t * Utility functions (private)\n\t * --------------------------------\n\t */\n\t\tfunction emit(event) {\n\t\t\tvar pointer = listener[event],\n\t\t\t\tparameter, i, callback;\n\n\t\t\tif(pointer) {\n\t\t\t\tparameter = arrayPrototypeSlice.call(arguments, 1);\n\n\t\t\t\tfor(i = 0; (callback = pointer[i]); i++) {\n\t\t\t\t\tcallback.apply(NULL, parameter);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction log(error) {\n\t\t\t/* eslint-disable no-console */\n\t\t\tif(!isTypeOf(console, 'undefined')) {\n\t\t\t\tconsole.error(error.toString());\n\t\t\t}\n\t\t\t/* eslint-enable no-console */\n\t\t}\n\n\t\tfunction assign(id, factory) {\n\t\t\tprovide(id, function() { return factory; });\n\t\t}\n\n\t\tfunction escapeRegularExpression(value) {\n\t\t\treturn value.replace(regexMatchRegex, '\\\\$&');\n\t\t}\n\n\t\tfunction createRegularExpression(expression, modifier) {\n\t\t\treturn new RegExp(expression, modifier);\n\t\t}\n\n\t\tfunction getTimestamp() {\n\t\t\treturn +new Date();\n\t\t}\n\n\t\tfunction resolvePath(path, context) {\n\t\t\tpath = path.replace(regexMatchParameter, '');\n\n\t\t\tif(!regexIsAbsolutePath.test(path) && !regexIsAbsoluteUri.test(path)) {\n\t\t\t\tpath = '/' + resolveUrl(((context && resolveUrl(context + '/../')) || '/') + path).replace(regexMatchBaseUrl, '');\n\t\t\t}\n\n\t\t\treturn path;\n\t\t}\n\n\t\tfunction resolveDependency(dependency, context) {\n\t\t\tvar path = isTypeOf(dependency, STRING_STRING) ? resolvePath(dependency, context) : NULL,\n\t\t\t\tdefinition, deferred;\n\n\t\t\tif(path) {\n\t\t\t\tif(context && (dependency === DEMAND_ID || dependency === PROVIDE_ID || dependency === SETTINGS_ID)) {\n\t\t\t\t\tswitch(dependency) {\n\t\t\t\t\t\tcase DEMAND_ID:\n\t\t\t\t\t\t\tpath       = MODULE_PREFIX_LOCAL + path;\n\t\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\t\tvar scopedDemand = demand.bind(context),\n\t\t\t\t\t\t\t\t\tkey;\n\n\t\t\t\t\t\t\t\tfor(key in demand) {\n\t\t\t\t\t\t\t\t\tscopedDemand[key] = demand[key];\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn scopedDemand;\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase PROVIDE_ID:\n\t\t\t\t\t\t\tpath       = MODULE_PREFIX_LOCAL + path;\n\t\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\t\treturn provide.bind(context);\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase SETTINGS_ID:\n\t\t\t\t\t\t\tpath       = MODULE_PREFIX_SETTINGS + context;\n\t\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\t\treturn settings.modules[context] || NULL;\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t!registry[path] && provide(path, definition);\n\t\t\t\t}\n\n\t\t\t\treturn (registry[path] || (registry[path] = new Loader(path, resolveParameter(dependency, context)))).pledge;\n\t\t\t} else {\n\t\t\t\tdeferred = Pledge.defer();\n\n\t\t\t\tdeferred.resolve(dependency);\n\n\t\t\t\treturn deferred.pledge;\n\t\t\t}\n\t\t}\n\n\t\tfunction resolveParameter(path, context) {\n\t\t\tvar parameter = path.match(regexMatchParameter),\n\t\t\t\tpattern   = settings.pattern,\n\t\t\t\tkey, match;\n\n\t\t\tpath = resolvePath(path, context);\n\n\t\t\tif(!regexIsAbsoluteUri.test(path)) {\n\t\t\t\tfor(key in pattern) {\n\t\t\t\t\tpattern[key].matches(path) && (!match || match.weight < pattern[key].weight) && (match = pattern[key]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tmock:     (parameter && parameter[1]) ? true : false,\n\t\t\t\tcache:    (parameter && parameter[2]) ? parameter[2] === '+' : NULL,\n\t\t\t\thandler:  (parameter && parameter[3]) || settings.handler,\n\t\t\t\tversion:  (parameter && parameter[4]) || settings.version,\n\t\t\t\tlifetime: (parameter && parameter[5] && parameter[5] * 1000) || settings.lifetime,\n\t\t\t\turl:      match ? resolveUrl(match.process(path)) : path\n\t\t\t};\n\t\t}\n\n\t\tfunction resolveLoader(loader) {\n\t\t\tvar handler = loader.handler;\n\n\t\t\temit('preProcess', loader);\n\n\t\t\tif(loader.deferred.pledge.state === PLEDGE_PENDING) {\n\t\t\t\thandler.onPreProcess && handler.onPreProcess.call(loader);\n\t\t\t\thandler.process && queue.add(loader);\n\t\t\t}\n\t\t}\n\n\t/**\n\t * --------------------------------\n\t * Utility functions (public)\n\t * --------------------------------\n\t */\n\t\t/**\n\t\t * isArray\n\t\t *\n\t\t * Check whether a given value is of type array\n\t\t *\n\t\t * @param value\n\t\t *\n\t\t * @return {boolean}\n\t\t */\n\t\tfunction isArray(value) {\n\t\t\treturn objectPrototypeToString.call(value) === '[object Array]';\n\t\t}\n\n\t\t/**\n\t\t * isObject\n\t\t *\n\t\t * Check whether a given object is of type object\n\t\t *\n\t\t * @param object\n\t\t *\n\t\t * @return {boolean}\n\t\t */\n\t\tfunction isObject(object) {\n\t\t\treturn object && isTypeOf(object, 'object');\n\t\t}\n\n\t\t/**\n\t\t * isTypeOf\n\t\t *\n\t\t * Check whether a given object is of specified type\n\t\t *\n\t\t * @param object\n\t\t * @param {string} type\n\t\t *\n\t\t * @return {boolean}\n\t\t */\n\t\tfunction isTypeOf(object, type) {\n\t\t\treturn typeof object === type;\n\t\t}\n\n\t\t/**\n\t\t * isInstanceOf\n\t\t *\n\t\t * Check whether a given object is an instance of specified type\n\t\t *\n\t\t * @param object\n\t\t * @param module\n\t\t *\n\t\t * @return {boolean}\n\t\t */\n\t\tfunction isInstanceOf(object, module) {\n\t\t\treturn object instanceof module;\n\t\t}\n\n\t\t/**\n\t\t * isPositiveInteger\n\t\t *\n\t\t * Check whether a given value is a positive integer\n\t\t *\n\t\t * @param value\n\t\t *\n\t\t * @return {boolean}\n\t\t */\n\t\tfunction isPositiveInteger(value) {\n\t\t\treturn isTypeOf(value, 'number') && isFinite(value) && Math.floor(value) === value && value >= 0;\n\t\t}\n\n\t\t/**\n\t\t * resolveUrl\n\t\t *\n\t\t * Convert a given URL to its resolved absolute representation\n\t\t *\n\t\t * @param {string} url\n\t\t *\n\t\t * @return {string}\n\t\t */\n\t\tfunction resolveUrl(url) {\n\t\t\tresolver.href = url;\n\n\t\t\treturn resolver.href;\n\t\t}\n\n\t\t/**\n\t\t * mock\n\t\t *\n\t\t * Mock an array of module paths\n\t\t *\n\t\t * @param {array} modules\n\t\t *\n\t\t * @return {Pledge}\n\t\t */\n\t\tfunction mock(modules) {\n\t\t\tvar pledges = [],\n\t\t\t\ti = 0, module, pledge, parameter;\n\n\t\t\tfor(; (module = modules[i]); i++) {\n\t\t\t\tparameter     = module.match(regexMatchParameter);\n\t\t\t\tmodule        = module.replace(regexMatchParameter, '');\n\t\t\t\tmodules[i]    = (parameter ? 'mock:' + parameter.slice(1).join('')  : 'mock:') + '!' + module;\n\t\t\t\tpledge        = (mocks[module] = Pledge.defer()).pledge;\n\n\t\t\t\tpledge.then(function(loader) { delete mocks[loader.path]; });\n\n\t\t\t\tpledges.push(pledge);\n\t\t\t}\n\n\t\t\tdemand.apply(NULL, modules);\n\n\t\t\treturn Pledge.all(pledges);\n\t\t}\n\n\t/**\n\t * --------------------------------\n\t * Utility modules (private)\n\t * --------------------------------\n\t */\n\t\tfunction Pattern(pattern, url) {\n\t\t\tvar self = this;\n\n\t\t\tself.weight       = pattern.length;\n\t\t\tself.url          = resolveUrl(url).replace(regexMatchTrailingSlash, '$1');\n\t\t\tself.matchPattern = createRegularExpression('^' + escapeRegularExpression(pattern));\n\t\t\tself.matchUrl     = createRegularExpression('^' + escapeRegularExpression(url));\n\t\t}\n\n\t\tPattern.prototype = {\n\t\t\t/* only for reference\n\t\t\tweight:       0,\n\t\t\turl:          NULL,\n\t\t\tmatchPattern: NULL,\n\t\t\tmatchUrl:     NULL,\n\t\t\t*/\n\t\t\tmatches: function(path) {\n\t\t\t\treturn this.matchPattern.test(path);\n\t\t\t},\n\t\t\tremove: function(url) {\n\t\t\t\treturn url.replace(this.matchUrl, '');\n\t\t\t},\n\t\t\tprocess: function(path) {\n\t\t\t\treturn path.replace(this.matchPattern, this.url);\n\t\t\t}\n\t\t};\n\n\t\tfunction Loader(path, parameter) {\n\t\t\tvar self     = this,\n\t\t\t\tdeferred = Pledge.defer(),\n\t\t\t\tpledge   = deferred.pledge,\n\t\t\t\thandler  = parameter.handler,\n\t\t\t\txhr, timeout;\n\n\t\t\tself.deferred = deferred;\n\t\t\tself.path     = path;\n\t\t\tself.url      = parameter.url;\n\t\t\tself.cache    = parameter.cache;\n\t\t\tself.version  = parameter.version;\n\t\t\tself.lifetime = parameter.lifetime;\n\n\t\t\tdemand(MODULE_PREFIX_HANDLER + handler)\n\t\t\t\t.then(\n\t\t\t\t\tfunction(handler) {\n\t\t\t\t\t\tself.handler = handler;\n\t\t\t\t\t\tself.mock    = parameter.mock ? mocks[self.path] : NULL;\n\n\t\t\t\t\t\thandler.onPreRequest && handler.onPreRequest.call(self);\n\n\t\t\t\t\t\tif(!self.mock) {\n\t\t\t\t\t\t\tif(self.cache === false || !storage.get(self)) {\n\t\t\t\t\t\t\t\temit('preRequest', self);\n\n\t\t\t\t\t\t\t\tif(pledge.state === PLEDGE_PENDING) {\n\t\t\t\t\t\t\t\t\txhr = regexMatchBaseUrl.test(self.url) ? new XHR() : new XDR();\n\n\t\t\t\t\t\t\t\t\txhr.onprogress = function() {};\n\t\t\t\t\t\t\t\t\txhr.ontimeout = xhr.onerror = xhr.onabort = function() {\n\t\t\t\t\t\t\t\t\t\tdeferred.reject(new Reason('timeout requesting', self.path));\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\txhr.onload = function() {\n\t\t\t\t\t\t\t\t\t\tvar type = xhr.getResponseHeader && xhr.getResponseHeader('content-type');\n\n\t\t\t\t\t\t\t\t\t\ttimeout = clearTimeout(timeout);\n\n\t\t\t\t\t\t\t\t\t\tif((!('status' in xhr) || xhr.status === 200) && (!type || !handler.matchType || handler.matchType.test(type))) {\n\t\t\t\t\t\t\t\t\t\t\tself.source = xhr.responseText;\n\n\t\t\t\t\t\t\t\t\t\t\temit('postRequest', self);\n\n\t\t\t\t\t\t\t\t\t\t\tif(pledge.state === PLEDGE_PENDING) {\n\t\t\t\t\t\t\t\t\t\t\t\thandler.onPostRequest && handler.onPostRequest.call(self);\n\t\t\t\t\t\t\t\t\t\t\t\tresolveLoader(self);\n\n\t\t\t\t\t\t\t\t\t\t\t\tif(self.cache !== false) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tpledge.then(function() { storage.set(self); });\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tdeferred.reject(new Reason('error requesting', self.path));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\txhr.open('GET', self.url, true);\n\t\t\t\t\t\t\t\t\txhr.send();\n\n\t\t\t\t\t\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\t\t\t\t\t\tif(xhr.readyState < 4) {\n\t\t\t\t\t\t\t\t\t\t\txhr.abort();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}, settings.timeout);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\tresolveLoader(self);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif(self.mock.dependencies) {\n\t\t\t\t\t\t\t\tself.mock.dependencies.then(\n\t\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t\tself.mock.resolve(self);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tself.mock.reject\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tself.mock.resolve(self);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tdeferred.reject\n\t\t\t\t);\n\n\t\t\treturn deferred;\n\t\t}\n\n\t\t/* only for reference\n\t\tLoader.prototype = {\n\t\t\tdeferred: NULL,\n\t\t\tpath:     NULL,\n\t\t\turl:      NULL,\n\t\t\thandler:  NULL,\n\t\t\tsource:   NULL,\n\t\t\tmock:     NULL,\n\t\t\tcache:    NULL,\n\t\t\tlifetime: NULL,\n\t\t\tversion:  NULL,\n\t\t\tstate:    { version: NULL, expires: NULL, url: NULL } // will only be set by storage\n\t\t};\n\t\t*/\n\n\t/**\n\t * --------------------------------\n\t * Utility modules (public)\n\t * --------------------------------\n\t */\n\t\t/**\n\t\t * Pledge\n\t\t *\n\t\t * @param {function} executor\n\t\t *\n\t\t * @constructor\n\t\t */\n\t\tfunction Pledge(executor) {\n\t\t\tvar self     = this,\n\t\t\t\tlistener = { resolved: [], rejected: [] };\n\n\t\t\tfunction resolve() {\n\t\t\t\thandle(PLEDGE_RESOLVED, arguments);\n\t\t\t}\n\n\t\t\tfunction reject() {\n\t\t\t\thandle(PLEDGE_REJECTED, arguments);\n\t\t\t}\n\n\t\t\tfunction handle(aState, aParameter) {\n\t\t\t\tvar pointer, result;\n\n\t\t\t\tif(self.state === PLEDGE_PENDING) {\n\t\t\t\t\tself.state = aState;\n\t\t\t\t\tself.value = aParameter;\n\n\t\t\t\t\twhile(pointer = listener[aState].shift()) {\n\t\t\t\t\t\tresult = pointer.handler.apply(NULL, aParameter);\n\n\t\t\t\t\t\tif(result && typeof result.then === 'function') {\n\t\t\t\t\t\t\tresult.then(pointer.deferred.resolve, pointer.deferred.reject);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpointer.deferred.resolve(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlistener = NULL;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.then = function(aResolved, aRejected) {\n\t\t\t\tvar deferred = Pledge.defer();\n\n\t\t\t\tif(self.state === PLEDGE_PENDING) {\n\t\t\t\t\taResolved && listener[PLEDGE_RESOLVED].push({ handler: aResolved, deferred: deferred });\n\t\t\t\t\taRejected && listener[PLEDGE_REJECTED].push({ handler: aRejected, deferred: deferred });\n\t\t\t\t} else {\n\t\t\t\t\tswitch(self.state) {\n\t\t\t\t\t\tcase PLEDGE_RESOLVED:\n\t\t\t\t\t\t\tdeferred.resolve(aResolved && aResolved.apply(NULL, self.value));\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase PLEDGE_REJECTED:\n\t\t\t\t\t\t\tdeferred.reject(aRejected && aRejected.apply(NULL, self.value));\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn deferred.pledge;\n\t\t\t};\n\n\t\t\texecutor(resolve, reject);\n\t\t}\n\n\t\tPledge.prototype = {\n\t\t\tstate:  PLEDGE_PENDING\n\t\t\t/* only for reference\n\t\t\tvalue:  NULL,\n\t\t\tthen:   NULL,\n\t\t\tcache:  NULL, // will only be set by storage\n\t\t\t*/\n\t\t};\n\n\t\tPledge.defer = function() {\n\t\t\tvar self = {};\n\n\t\t\tself.pledge = new Pledge(function(aResolve, aReject) {\n\t\t\t\tself.resolve = aResolve;\n\t\t\t\tself.reject  = aReject;\n\t\t\t});\n\n\t\t\treturn self;\n\t\t};\n\n\t\tPledge.all = function(pledges) {\n\t\t\tvar deferred      = Pledge.defer(),\n\t\t\t\tresolved      = [],\n\t\t\t\trejected      = [],\n\t\t\t\tcountTotal    = pledges.length,\n\t\t\t\tcountResolved = 0,\n\t\t\t\ti = 0, pledge;\n\n\t\t\tfunction observePledge(index, pledge) {\n\t\t\t\tpledge.then(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tresolved[index] = arrayPrototypeSlice.call(arguments);\n\n\t\t\t\t\t\tcountResolved++;\n\n\t\t\t\t\t\tcheckState();\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\trejected.push(arrayPrototypeSlice.call(arguments));\n\n\t\t\t\t\t\tcheckState();\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tfunction checkState() {\n\t\t\t\tif(countResolved === countTotal) {\n\t\t\t\t\tdeferred.resolve.apply(NULL, arrayPrototypeConcat.apply([], resolved));\n\t\t\t\t} else if(rejected.length + countResolved === countTotal) {\n\t\t\t\t\tdeferred.reject.apply(NULL, arrayPrototypeConcat.apply([], rejected));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor(; pledge = pledges[i]; i++) {\n\t\t\t\tobservePledge(i, pledge);\n\t\t\t}\n\n\t\t\treturn deferred.pledge;\n\t\t};\n\n\t\tPledge.race = function(pledges) {\n\t\t\tvar deferred = Pledge.defer(),\n\t\t\t\ti = 0, pledge;\n\n\t\t\tfor(; pledge = pledges[i]; i++) {\n\t\t\t\tpledge.then(deferred.resolve, deferred.reject);\n\t\t\t}\n\n\t\t\treturn deferred.pledge;\n\t\t};\n\n\t\t/**\n\t\t * Reason\n\t\t *\n\t\t * @param message\n\t\t * @param module\n\t\t * @param stack\n\t\t *\n\t\t * @constructor\n\t\t */\n\t\tfunction Reason(message, module, stack) {\n\t\t\tthis.message = message;\n\n\t\t\tmodule && (this.module = module);\n\t\t\tstack && (this.stack = arrayPrototypeSlice.call(stack));\n\t\t}\n\n\t\tReason.prototype = {\n\t\t\t/* only for reference\n\t\t\tmessage: NULL,\n\t\t\tmodule:  NULL,\n\t\t\tstack:   NULL,\n\t\t\t*/\n\t\t\ttoString: function() {\n\t\t\t\tvar self   = this,\n\t\t\t\t\tresult = DEMAND_ID + ': ' + self.message + ' ' + (self.module ? '\"' + self.module + '\"' : '');\n\n\t\t\t\tif(self.stack) {\n\t\t\t\t\tresult = Reason.traverse(self.stack, result, 1);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t};\n\n\t\tReason.traverse = function(stack, value, depth) {\n\t\t\tvar indention = new Array(depth + 1).join(' '),\n\t\t\t\ti = 0, item;\n\n\t\t\tfor(; item = stack[i]; i++) {\n\t\t\t\tvalue += '\\n' + indention + '> ' + item.message + ' ' + (item.module ? '\"' + item.module + '\"' : '');\n\n\t\t\t\tif(item.stack) {\n\t\t\t\t\tvalue = Reason.traverse(item.stack, value, depth + 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn value;\n\t\t};\n\n\t\t/**\n\t\t * Queue\n\t\t *\n\t\t * @constructor\n\t\t */\n\t\tfunction Queue() {\n\t\t\tthis.items = 0;\n\t\t\tthis.stack = [];\n\t\t}\n\n\t\tQueue.prototype = {\n\t\t\t/* only for reference\n\t\t\titems:   NULL,\n\t\t\tqueue:   NULL,\n\t\t\tcurrent: NULL,\n\t\t\t*/\n\t\t\tadd: function() {\n\t\t\t\tqueue.stack  = queue.stack.concat(arrayPrototypeSlice.call(arguments));\n\t\t\t\tqueue.items += arguments.length;\n\n\t\t\t\t!queue.current && queue.process();\n\t\t\t},\n\t\t\tprocess: function() {\n\t\t\t\tvar current;\n\n\t\t\t\tif(queue.items) {\n\t\t\t\t\tqueue.items--;\n\n\t\t\t\t\tcurrent = queue.current = queue.stack.shift();\n\n\t\t\t\t\tcurrent.handler.process.call(current);\n\t\t\t\t\temit('postProcess', current);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\n\t/**\n\t * --------------------------------\n\t * Demand\n\t * --------------------------------\n\t */\n\t\tfunction demand() {\n\t\t\tvar dependencies = arrayPrototypeSlice.call(arguments),\n\t\t\t\ti = 0, dependency;\n\n\t\t\tfor(; (dependency = dependencies[i]); i++) {\n\t\t\t\tdependencies[i] = resolveDependency(dependency, this !== window ? this : NULL);\n\t\t\t}\n\n\t\t\treturn Pledge.all(dependencies);\n\t\t}\n\n\t\tdemand.configure = function(parameter) {\n\t\t\tvar cache    = parameter.cache,\n\t\t\t\tversion  = parameter.version,\n\t\t\t\ttimeout  = parameter.timeout,\n\t\t\t\tlifetime = parameter.lifetime,\n\t\t\t\tbase     = parameter.base,\n\t\t\t\tpattern  = parameter.pattern,\n\t\t\t\tmodules  = parameter.modules,\n\t\t\t\tpointer  = settings.modules,\n\t\t\t\tkey;\n\n\t\t\tif(isTypeOf(cache, STRING_BOOLEAN)) {\n\t\t\t\tsettings.cache[''] = { weight: 0, state: cache };\n\t\t\t} else if(isObject(cache)) {\n\t\t\t\tfor(key in cache) {\n\t\t\t\t\tsettings.cache[key] = { weight: key.length, state: cache[key] };\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(isTypeOf(version, STRING_STRING)) {\n\t\t\t\tsettings.version = version;\n\t\t\t}\n\n\t\t\tif(isPositiveInteger(timeout)) {\n\t\t\t\tsettings.timeout = Math.min(Math.max(timeout, 2), 12) * 1000;\n\t\t\t}\n\n\t\t\tif(isPositiveInteger(lifetime) && lifetime > 0) {\n\t\t\t\tsettings.lifetime = lifetime * 1000;\n\t\t\t}\n\n\t\t\tif(isTypeOf(base, STRING_STRING) && base !== '') {\n\t\t\t\tsettings.pattern.base = new Pattern('', base);\n\t\t\t}\n\n\t\t\tif(isObject(pattern)) {\n\t\t\t\tfor(key in pattern) {\n\t\t\t\t\tkey !== 'base' && (settings.pattern[key] = new Pattern(key, pattern[key]));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(isObject(modules)) {\n\t\t\t\tfor(key in modules) {\n\t\t\t\t\tif(key !== MODULE_PREFIX_STORAGE) {\n\t\t\t\t\t\tpointer[key] = modules[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tdemand.remove = function(path) {\n\t\t\tif(registry[path]) {\n\t\t\t\t!!registry[path].cache && storage.clean.path(path);\n\n\t\t\t\tdelete registry[path];\n\t\t\t\tdelete mocks[path];\n\t\t\t}\n\t\t};\n\n\t\tdemand.on = function(events, callback) {\n\t\t\tvar event;\n\n\t\t\tif(isTypeOf(events, STRING_STRING) && isTypeOf(callback, STRING_FUNCTION)) {\n\t\t\t\tevents = events.split(' ');\n\n\t\t\t\twhile(event = events.shift()) {\n\t\t\t\t\tif(regexMatchEvent.test(event)) {\n\t\t\t\t\t\t(listener[event] || (listener[event] = [])).push(callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn demand;\n\t\t};\n\n\t\tdemand.list = function(state) {\n\t\t\tvar keys, path, pledge;\n\n\t\t\tif(state) {\n\t\t\t\tkeys = [];\n\n\t\t\t\tfor(path in registry) {\n\t\t\t\t\tpledge = registry[path].pledge;\n\n\t\t\t\t\tif(pledge.state === state || pledge.cache === state) {\n\t\t\t\t\t\tkeys.push(path);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tkeys = Object.keys(registry);\n\t\t\t}\n\n\t\t\treturn keys;\n\t\t};\n\t\n\t/**\n\t * --------------------------------\n\t * Provide\n\t * --------------------------------\n\t */\n\t\tfunction provide() {\n\t\t\tvar parameter    = arguments,\n\t\t\t\tpath         = isTypeOf(parameter[0], STRING_STRING) ? parameter[0] : NULL,\n\t\t\t\tdependencies = isArray(parameter[path ? 1 : 0]) ? parameter[path ? 1 : 0] : NULL,\n\t\t\t\tdefinition   = dependencies ? parameter[path ? 2 : 1] : parameter[path ? 1 : 0],\n\t\t\t\tdeferred, pledge, isFunction;\n\n\t\t\tif(!path && queue.current) {\n\t\t\t\tpath = queue.current.path;\n\n\t\t\t\tqueue.current = NULL;\n\n\t\t\t\tqueue.items > 0 && queue.process();\n\t\t\t}\n\n\t\t\tif(path) {\n\t\t\t\tpath       = resolvePath(path, this);\n\t\t\t\tdeferred   = registry[path] || (registry[path] = Pledge.defer());\n\t\t\t\tpledge     = deferred.pledge;\n\t\t\t\tisFunction = isTypeOf(definition, STRING_FUNCTION);\n\n\t\t\t\tif(pledge.state === PLEDGE_PENDING) {\n\t\t\t\t\tif(dependencies) {\n\t\t\t\t\t\tdemand\n\t\t\t\t\t\t\t.apply(path, dependencies)\n\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\tfunction() { deferred.resolve(isFunction ? definition.apply(NULL, arguments) : definition); },\n\t\t\t\t\t\t\t\tfunction() { log(new Reason('error providing', path, arguments)); }\n\t\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.resolve(isFunction ? definition() : definition);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow 'unspecified anonymous provide';\n\t\t\t}\n\t\t}\n\n\t/**\n\t * --------------------------------\n\t * Inline modules\n\t * --------------------------------\n\t */\n\t\t/**\n\t\t * /demand/handler/module\n\t\t */\n\t\t(function() {\n\t\t\tfunction definition() {\n\t\t\t\tvar target              = document.getElementsByTagName('head')[0],\n\t\t\t\t\tregexMatchSourcemap = /\\/\\/#\\s+sourceMappingURL\\s*=\\s*(?!(?:http[s]?:)?\\/\\/)(.+?)\\.map/g;\n\n\t\t\t\treturn {\n\t\t\t\t\tmatchType: /^(application|text)\\/(x-)?javascript/,\n\t\t\t\t\tonPreRequest: function() {\n\t\t\t\t\t\tvar url  = this.url;\n\n\t\t\t\t\t\tthis.url = url.slice(-3) !== '.js' ? url + '.js' : url;\n\t\t\t\t\t},\n\t\t\t\t\tonPostRequest: function() {\n\t\t\t\t\t\tvar self   = this,\n\t\t\t\t\t\t\tsource = self.source,\n\t\t\t\t\t\t\tmatch, replacement;\n\n\t\t\t\t\t\tif(source) {\n\t\t\t\t\t\t\twhile(match = regexMatchSourcemap.exec(source)) {\n\t\t\t\t\t\t\t\tif(regexIsAbsolutePath.test(match[1])) {\n\t\t\t\t\t\t\t\t\tresolver.href = self.url;\n\n\t\t\t\t\t\t\t\t\treplacement = resolver.protocol + '//' + resolver.host + match[1];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treplacement = resolveUrl(self.url + '/../' + match[1]);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tsource = source.replace(match[0], '//# sourceMappingURL=' + replacement + '.map');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tself.source = source;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tprocess: function() {\n\t\t\t\t\t\tvar source = this.source,\n\t\t\t\t\t\t\tscript;\n\n\t\t\t\t\t\tif(source) {\n\t\t\t\t\t\t\tscript       = document.createElement('script');\n\t\t\t\t\t\t\tscript.async = true;\n\t\t\t\t\t\t\tscript.text  = source;\n\n\t\t\t\t\t\t\tscript.setAttribute('demand-path', this.path);\n\n\t\t\t\t\t\t\ttarget.appendChild(script);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tprovide(MODULE_PREFIX_HANDLER + 'module', definition);\n\t\t}());\n\n\t\t/**\n\t\t * /demand/storage\n\t\t */\n\t\t(function(){\n\t\t\tfunction definition() {\n\t\t\t\tvar STORAGE_PREFIX       = '[' + DEMAND_ID + ']',\n\t\t\t\t\tSTORAGE_SUFFIX_STATE = '[state]',\n\t\t\t\t\tSTORAGE_SUFFIX_VALUE = '[value]',\n\t\t\t\t\tregexMatchState      = createRegularExpression('^' + escapeRegularExpression(STORAGE_PREFIX) + '\\\\[(.+?)\\\\]' + escapeRegularExpression(STORAGE_SUFFIX_STATE) + '$'),\n\t\t\t\t\tlocalStorage         = (function() { try { return 'localStorage' in global && global.localStorage; } catch(exception) { return false; } }()),\n\t\t\t\t\thasRemainingSpace    = localStorage && 'remainingSpace' in localStorage;\n\n\t\t\t\tfunction isEnabled(loader) {\n\t\t\t\t\tvar key, pointer, match;\n\n\t\t\t\t\tif(loader.cache !== NULL) {\n\t\t\t\t\t\treturn loader.cache;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor(key in settings.cache) {\n\t\t\t\t\t\tpointer = settings.cache[key];\n\n\t\t\t\t\t\tif(loader.path.indexOf(key) === 0 && (!match || pointer.weight > match.weight)) {\n\t\t\t\t\t\t\tmatch = pointer;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn match ? match.state : false;\n\t\t\t\t}\n\n\t\t\t\tfunction Storage() {\n\t\t\t\t\tthis.clear.expired();\n\t\t\t\t}\n\n\t\t\t\tStorage.prototype = {\n\t\t\t\t\tget: function(loader) {\n\t\t\t\t\t\tvar path = loader.path,\n\t\t\t\t\t\t\tid, state, pledge;\n\n\t\t\t\t\t\tif(localStorage && isEnabled(loader)) {\n\t\t\t\t\t\t\tid     = STORAGE_PREFIX + '[' + path + ']';\n\t\t\t\t\t\t\tstate  = JSON.parse(localStorage.getItem(id + STORAGE_SUFFIX_STATE));\n\t\t\t\t\t\t\tpledge = loader.deferred.pledge;\n\n\t\t\t\t\t\t\tif(state && state.version === loader.version && state.url === loader.url && ((!state.expires && !loader.lifetime) || state.expires > getTimestamp())) {\n\t\t\t\t\t\t\t\tpledge.cache  = 'hit';\n\t\t\t\t\t\t\t\tloader.source = localStorage.getItem(id + STORAGE_SUFFIX_VALUE);\n\n\t\t\t\t\t\t\t\temit('cacheHit', loader);\n\n\t\t\t\t\t\t\t\treturn loader.source;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpledge.cache = 'miss';\n\n\t\t\t\t\t\t\t\temit('cacheMiss', loader);\n\t\t\t\t\t\t\t\tthis.clear.path(path);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tset: function(loader) {\n\t\t\t\t\t\tvar path = loader.path,\n\t\t\t\t\t\t\tlifetime, id, spaceBefore;\n\n\t\t\t\t\t\tif(localStorage && isEnabled(loader)) {\n\t\t\t\t\t\t\temit('preCache', loader);\n\n\t\t\t\t\t\t\tlifetime = loader.lifetime;\n\t\t\t\t\t\t\tid       = STORAGE_PREFIX + '[' + path + ']';\n\n\t\t\t\t\t\t\tloader.state = { version: loader.version, expires: lifetime ? getTimestamp() + lifetime : lifetime, url: loader.url };\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tspaceBefore = hasRemainingSpace ? localStorage.remainingSpace : NULL;\n\n\t\t\t\t\t\t\t\tlocalStorage.setItem(id + STORAGE_SUFFIX_VALUE, loader.source);\n\t\t\t\t\t\t\t\tlocalStorage.setItem(id + STORAGE_SUFFIX_STATE, JSON.stringify(loader.state));\n\n\t\t\t\t\t\t\t\t// strict equality check with \"===\" is required due to spaceBefore might be \"0\"\n\t\t\t\t\t\t\t\tif(spaceBefore !== NULL && localStorage.remainingSpace === spaceBefore) {\n\t\t\t\t\t\t\t\t\tthrow 'QUOTA_EXCEEDED_ERR';\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\temit('postCache', loader);\n\t\t\t\t\t\t\t} catch(error) {\n\t\t\t\t\t\t\t\temit('cacheExceed', loader);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tclear: {\n\t\t\t\t\t\tpath: function(path) {\n\t\t\t\t\t\t\tvar id;\n\n\t\t\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\t\t\tid = STORAGE_PREFIX + '[' + path + ']';\n\n\t\t\t\t\t\t\t\tlocalStorage.removeItem(id + STORAGE_SUFFIX_STATE);\n\t\t\t\t\t\t\t\tlocalStorage.removeItem(id + STORAGE_SUFFIX_VALUE);\n\n\t\t\t\t\t\t\t\temit('cacheClear', path);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tall: function() {\n\t\t\t\t\t\t\tvar key, match;\n\n\t\t\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\t\t\tfor(key in localStorage) {\n\t\t\t\t\t\t\t\t\tmatch = key.match(regexMatchState);\n\n\t\t\t\t\t\t\t\t\tif(match) {\n\t\t\t\t\t\t\t\t\t\tthis.path(match[1]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\texpired: function() {\n\t\t\t\t\t\t\tvar key, match, state;\n\n\t\t\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\t\t\tfor(key in localStorage) {\n\t\t\t\t\t\t\t\t\tmatch = key.match(regexMatchState);\n\n\t\t\t\t\t\t\t\t\tif(match) {\n\t\t\t\t\t\t\t\t\t\tstate = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '[' + match[1] + ']' + STORAGE_SUFFIX_STATE));\n\n\t\t\t\t\t\t\t\t\t\tif(state && state.expires > 0 && state.expires <= getTimestamp()) {\n\t\t\t\t\t\t\t\t\t\t\tthis.path(match[1]);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tdemand.clear = (storage = new Storage()).clear;\n\n\t\t\t\treturn storage;\n\t\t\t}\n\n\t\t\tprovide(MODULE_PREFIX_STORAGE, definition);\n\t\t}());\n\n\t/**\n\t * --------------------------------\n\t * Initialization\n\t * --------------------------------\n\t */\n\t\tregexMatchBaseUrl = createRegularExpression('^' + escapeRegularExpression(resolveUrl('/')));\n\n\t\tdemand.configure({ cache: true, base: '/', pattern: { '/demand': resolveUrl(((snippet && snippet.url) || location.href) + '/../').slice(0, -1)} });\n\t\tsnippet && snippet.settings && demand.configure(snippet.settings);\n\n\t\tassign(MODULE_PREFIX_VALIDATOR + 'isArray', isArray);\n\t\tassign(MODULE_PREFIX_VALIDATOR + 'isObject', isObject);\n\t\tassign(MODULE_PREFIX_VALIDATOR + 'isTypeOf', isTypeOf);\n\t\tassign(MODULE_PREFIX_VALIDATOR + 'isInstanceOf', isInstanceOf);\n\t\tassign(MODULE_PREFIX_VALIDATOR + 'isPositiveInteger', isPositiveInteger);\n\t\tassign(MODULE_PREFIX + 'function/resolveUrl', resolveUrl);\n\t\tassign(MODULE_PREFIX + 'mock', mock);\n\t\tassign(MODULE_PREFIX + 'queue', (queue = new Queue()).add);\n\t\tassign(MODULE_PREFIX + 'pledge', Pledge);\n\t\tassign(MODULE_PREFIX + 'reason', Reason);\n\n\t\tglobal.demand    = demand;\n\t\tglobal.provide   = provide;\n\n\t\tif(snippet && snippet.main) {\n\t\t\tdemand(snippet.main);\n\t\t}\n}(this, document, JSON, XMLHttpRequest, setTimeout, clearTimeout, 'demand' in this && demand, Array.prototype, Object.prototype, XMLHttpRequest));"],"sourceRoot":"/source/"}