/**
  * v1.0.34 generated on: Tue Apr 19 2016 17:20:23 GMT-0500 (CDT)
  * Copyright (c) 2014-2016, Ecor Ventures LLC. All Rights Reserved. See LICENSE (BSD).
  */
"use strict";Array.prototype.findIndex||(Array.prototype.findIndex=function(e){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],d=0;i>d;d++)if(t=n[d],e.call(r,t,d,n))return d;return-1}),window.NGN=window.NGN||{},window.NGN.DATA=window.NGN.DATA||{},window.NGN.DATA.Store=function(e){e=e||{};var t=this;Object.defineProperties(this,{model:NGN.define(!0,!1,!1,e.model||null),_data:NGN.define(!1,!0,!1,[]),_filters:NGN.define(!1,!0,!1,[]),_index:NGN.define(!1,!0,!1,e.index||[]),_created:NGN.define(!1,!0,!1,[]),_deleted:NGN.define(!1,!0,!1,[]),_loading:NGN.define(!1,!0,!1,!1),proxy:NGN.define(!1,!0,!1,null),allowDuplicates:NGN.define(!0,!0,!1,NGN.coalesce(e.allowDuplicates,!0)),errorOnDuplicate:NGN.define(!0,!1,!1,NGN.coalesce(e.errorOnDuplicate,e.allowDuplicates,!0)),eventListener:NGN.define(!1,!1,!1,function(e){return function(n){n.datastore&&n.datastore===t&&e(n)}}),on:NGN.define(!0,!1,!1,function(e,t){return NGN.BUS?void(["record.create","record.delete","index.create","index.delete","record.duplicate","record.update"].indexOf(e)>=0?NGN.BUS.on(e,this.eventListener(t)):console.warn(e+" is not a supported NGN.DATA.Store event.")):void console.warn("NGN.DATA.Model.on('"+e+"', ...) will not work because NGN.BUS is not available.")}),add:NGN.define(!0,!1,!1,function(e,n){var i;if(e instanceof NGN.DATA.Entity)i=e;else{try{e=JSON.parse(e)}catch(r){}if("object"!=typeof e)throw new Error("Cannot add a non-object record.");i=this.model?new this.model(e):e}i.hasOwnProperty("_store")&&(i._store=t);var d=this.isDuplicate(i);if(!d||(NGN.emit("record.duplicate",i),this.allowDuplicates))this.listen(i),this.applyIndices(i,this._data.length),this._data.push(i),!this._loading&&this._created.indexOf(i)<0&&this._created.push(i),!NGN.coalesce(n,!1)&&NGN.emit("record.create",i);else if(this.errorOnDuplicate)throw new Error("Cannot add duplicate record (allowDuplicates = false).")}),isDuplicate:NGN.define(!1,!1,!1,function(e){return this._data.indexOf(e)>=0?!1:this._data.filter(function(t){return t.checksum===e.checksum}).length>0}),listen:NGN.define(!1,!1,!1,function(e){e.on("field.update",function(n){t.updateIndice(n.field,n.old,n["new"],t._data.indexOf(e)),NGN.emit("record.update",e)}),e.on("field.delete",function(n){t.updateIndice(n.field,n.old,void 0,t._data.indexOf(e)),NGN.emit("record.update",e)})}),bulk:NGN.define(!0,!1,!1,function(e,n){this._loading=!0,n.forEach(function(e){t.add(e,!0)}),this._loading=!1,this._deleted=[],this._created=[],NGN.emit(e||"load")}),load:NGN.define(!0,!1,!1,function(){var e=Array.isArray(arguments[0])?arguments[0]:NGN._slice(arguments);this.bulk("load",e)}),reload:NGN.define(!0,!1,!1,function(e){this.clear();var t=Array.isArray(arguments[0])?arguments[0]:NGN._slice(arguments);this.bulk("reload",t)}),indexOf:NGN.define(!0,!1,!1,function(e){return"object"==typeof e&&(e instanceof NGN.DATA.Model||e.checksum)?this._data.findIndex(function(t){return t.checksum===e.checksum}):-1}),contains:NGN.define(!0,!1,!1,function(e){return this.indexOf(e)>=0}),remove:NGN.define(!0,!1,!1,function(e,t){var n,i=[];if("number"==typeof e)n=e;else if(e&&e.checksum&&null!==e.checksum||e instanceof NGN.DATA.Model)n=this.indexOf(e);else{var r=new this.model(e,!0);n=this._data.findIndex(function(e){return e.checksum===r.checksum})}if(0>n)throw new Error("Record removal failed (record not found at index "+(n||"").toString()+").");if(i=this._data.splice(n,1),i.length>0){if(i=i[0],this.unapplyIndices(n),!this._loading){var d=this._created.indexOf(i);d>=0?d>=0&&this._created.splice(d,1):this._deleted.indexOf(i)<0&&this._deleted.push(i)}!NGN.coalesce(t,!1)&&NGN.emit("record.delete",i)}}),clear:NGN.define(!0,!1,!1,function(){this._data=[],Object.keys(this._index).forEach(function(e){t._index[e]=[]}),NGN.emit("clear")}),data:NGN._get(function(){return this._data.map(function(e){return e.data})}),records:NGN._get(function(){return this.applyFilters(this._data)}),recordCount:NGN._get(function(){return this.applyFilters(this._data).length}),find:NGN.define(!0,!1,!1,function(e,n){if(0===this._data.length)return[];var i=[];switch(typeof e){case"function":i=this._data.filter(e);break;case"number":i=0>e||e>=this._data.length?null:this._data[e];break;case"string":var r=this.getIndices(this._data[0].idAttribute,e.trim());if(null!==r&&r.length>0)return r.forEach(function(e){i.push(t._data[e])}),i;var d=this._data.filter(function(t){return(t[t.idAttribute]||"").toString().trim()===e.trim()});i=0===d.length?null:d[0];break;case"object":if(e instanceof NGN.DATA.Model)return this.contains(e)?e:null;var o=[],a=[],s=Object.keys(e);s.forEach(function(n){var i=t.getIndices(n,e[n]);i?o=o.concat(i||[]):null!==n&&a.push(n)}),o.filter(function(e,t){return o.indexOf(e)===t}),a.length>0&&(i=this._data.filter(function(t,n){if(o.indexOf(n)>=0)return!1;for(var i=0;i<a.length;i++)if(t[a[i]]!==e[a[i]])return!1;return!0})),i=i.concat(o.map(function(e){return t._data[e]})).filter(function(t){for(var n=0;n<s.length;n++)if(e[s[n]]!==t[s[n]])return!1;return!0});break;default:i=this._data}return null===i?null:(!NGN.coalesce(n,!1)&&this.applyFilters(i instanceof Array?i:[i]),i)}),applyFilters:NGN.define(!1,!1,!1,function(e){return 0===this._filters.length?e:(this._filters.forEach(function(t){e=e.filter(t)}),e)}),addFilter:NGN.define(!0,!1,!1,function(e){this._filters.push(e),NGN.emit("filter.create",e)}),removeFilter:NGN.define(!0,!1,!1,function(e,t){t=NGN.coalesce(t,!1);var n=[];n="number"==typeof e?this._filters.splice(e,1):this._filters.splice(this._filters.indexOf(e),1),n.length>0&&!t&&NGN.emit("filter.delete",n[0])}),clearFilters:NGN.define(!0,!1,!1,function(e){if(e=NGN.coalesce(e,!1))return void(this._filters=[]);for(;this._filters.length>0;)NGN.emit("filter.delete",this._filters.pop())}),deduplicate:NGN.define(!0,!1,!1,function(e){e=NGN.coalesce(e,!0);var n=this.data.map(function(e){return JSON.stringify(e)}),i=[];n.forEach(function(e,r){n.indexOf(e)<r&&i.push(t.find(r))}),i.forEach(function(e){t.remove(e)})}),sort:NGN.define(!0,!1,!1,function(e){if("function"==typeof e)this.records.sort(e);else if("object"==typeof e){var t=Object.keys(e);this.records.sort(function(n,i){for(var r=0;r<t.length;r++){if(n.hasOwnProperty(t[r])&&!i.hasOwnProperty(t[r]))return 1;if(!n.hasOwnProperty(t[r])&&i.hasOwnProperty(t[r]))return-1;if(n[t[r]]!==i[t[r]])switch(e[t[r]].toString().trim().toLowerCase()){case"asc":return n[t[r]]>i[t[r]]?1:-1;case"desc":return n[t[r]]<i[t[r]]?1:-1;default:return"function"==typeof e[t[r]]?e[t[r]](n,i):0}}return 0})}this.reindex()}),createIndex:NGN.define(!0,!1,!1,function(e,n){this.model.hasOwnProperty(e)||console.warn("The store's model does not contain a data field called "+e+".");var i=this._index.hasOwnProperty(e);this._index[e]=this._index[e]||[],!NGN.coalesce(n,!1)&&!i&&NGN.emit("index.created",{field:e,store:t})}),deleteIndex:NGN.define(!0,!1,!1,function(e,n){this._index.hasOwnProperty(e)&&(delete this._index[e],!NGN.coalesce(n,!1)&&NGN.emit("index.created",{field:e,store:t}))}),clearIndices:NGN.define(!1,!1,!1,function(){Object.keys(this._index).forEach(function(e){t._index[e]=[]})}),deleteIndexes:NGN.define(!0,!1,!1,function(e){e=NGN.coalesce(e,!0),Object.keys(this._index).forEach(function(n){t.deleteIndex(n,e)})}),applyIndices:NGN.define(!1,!1,!1,function(e,n){var i=Object.keys(this._index);0!==i.length&&i.forEach(function(i){if(e.hasOwnProperty(i)){for(var r=t._index[i],d=0;d<r.length;d++)if(r[d][0]===e[i])return void t._index[i][d].push(n);t._index[i].push([e[i],n])}})}),unapplyIndices:NGN.define(!1,!1,!1,function(e){Object.keys(this._index).forEach(function(n){var i=t._index[n].indexOf(e);i>=0&&t._index[n].splice(i,1)})}),updateIndice:NGN.define(!1,!1,!1,function(e,n,i,r){if(this._index.hasOwnProperty(e)&&n!==i)for(var d=0,o=0;o<t._index[e].length;o++){var a=t._index[e][o][0];if(a===n?(t._index[e][o].splice(t._index[e][o].indexOf(r),1),d++):void 0===i?d++:a===i&&(t._index[e][o].push(r),t._index[e][o].shift(),t._index[e][o].sort(),t._index[e][o].unshift(a),d++),2===d)return}}),getIndices:NGN.define(!1,!1,!1,function(e,t){if(!this._index.hasOwnProperty(e))return null;var n=this._index[e].filter(function(e){return e.length>0&&e[0]===t});return 1===n.length?(n[0].shift(),n[0]):[]}),reindex:NGN.define(!1,!1,!1,function(){this.clearIndices(),this._data.forEach(function(e,n){t.applyIndices(e,n)})})}),!NGN.BUS&&this._index.length>0&&console.warn("Indexing will not work for record updates because NGN.BUS cannot be found.");var n={};this._index.forEach(function(e){n[e]=[]}),this._index=n},NGN.DATA.util.inherit(NGN.DATA.util.EventEmitter,NGN.DATA.Store);