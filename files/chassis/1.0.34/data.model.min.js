/**
  * v1.0.34 generated on: Tue Apr 19 2016 17:20:23 GMT-0500 (CDT)
  * Copyright (c) 2014-2016, Ecor Ventures LLC. All Rights Reserved. See LICENSE (BSD).
  */
"use strict";window.NGN=window.NGN||{},window.NGN.DATA=window.NGN.DATA||{},window.NGN.DATA.Entity=function(e){e=e||{};var t=this;Object.defineProperties(this,{idAttribute:NGN.define(!1,!1,!1,e.idAttribute||"id"),fields:NGN.define(!1,!0,!0,e.fields||{id:{required:!0,type:String,"default":e.id||null}}),virtuals:NGN.define(!1,!0,!0,e.virtuals||{}),validators:NGN.define(!1,!0,!1,{}),validation:NGN.define(!0,!0,!1,NGN.coalesce(e.validation,!0)),isNew:NGN.define(!1,!0,!1,!0),isDestroyed:NGN.define(!1,!0,!1,!1),modified:NGN._get(function(){return this.checksum!==this.benchmark}),oid:NGN.define(!1,!0,!0,e[this.idAttribute]||null),id:{enumerable:!0,get:function(){return this.oid},set:function(e){this.oid=e}},checksum:NGN._get(function(){return NGN.DATA.util.checksum(JSON.stringify(this.data))}),benchmark:NGN.define(!1,!0,!1,null),setUnmodified:NGN.define(!1,!1,!1,function(){this.benchmark=this.checksum,this.changelog=[]}),allowInvalidSave:NGN.define(!1,!0,!1,NGN.coalesce(e.allowInvalidSave,!1)),disableDataValidation:NGN.define(!1,!0,!1,NGN.coalesce(e.disableDataValidation,!1)),invalidDataAttributes:NGN.define(!1,!0,!1,[]),initialDataAttributes:NGN.define(!1,!0,!1,[]),changelog:NGN.define(!1,!0,!1,[]),_nativeValidators:NGN.define(!1,!1,!1,{min:function(e,t){return t instanceof Array?t.length>=e:t instanceof Number?t>=e:t instanceof String?t.trim().length>=e:t instanceof Date?t.parse()>=e.parse():!1},max:function(e,t){return t instanceof Array?t.length<=e:t instanceof Number?e>=t:t instanceof String?t.trim().length<=e:t instanceof Date?t.parse()<=e.parse():!1},"enum":function(e,t){return e.indexOf(t)>=0},required:function(e){return this.hasOwnProperty(e)}}),_dataMap:NGN.define(!0,!0,!1,e.dataMap||null),_reverseDataMap:NGN.define(!0,!0,!1,null),dataMap:{get:function(){return this._dataMap},set:function(e){this._dataMap=e,this._reverseDataMap=null}},reverseMap:NGN._get(function(){if(null!==this.dataMap){if(null!==this._reverseDataMap)return this._reverseDataMap;var e={};return Object.keys(this._dataMap).forEach(function(i){e[t._dataMap[i]]=i}),this._reverseDataMap=e,e}return null}),raw:NGN.define(!1,!0,!1,{}),_store:NGN.define(!1,!0,!1,null),datastore:NGN._get(function(){return this._store}),addValidator:NGN.define(!0,!1,!1,function(e,t){if(!this.hasOwnProperty(e))return void console.warn("No validator could be create for "+e.toUpperCase()+". It is not an attribute of "+this.type.toUpperCase()+".");switch(typeof t){case"function":this.validators[e]=this.validators[e]||[],this.validators[e].push(t),this.emit("validator.add",e);break;case"object":Array.isArray(t)?(this.validators[e]=this.validators[e]||[],this.validators[e].push(function(e){return t.indexOf(e)>=0}),this.emit("validator.add",e)):t.test?(this.validators[e]=this.validators[e]||[],this.validators[e].push(function(e){return t.test(e)}),this.emit("validator.add",e)):console.warn("No validator could be created for "+e.toUpperCase()+". The validator appears to be invalid.");break;case"string":case"number":case"date":this.validators[e]=this.validators[e]||[],this.validators[e].push(function(e){return e===t}),this.emit("validator.add",e);break;default:console.warn("No validator could be create for "+e.toUpperCase()+". The validator appears to be invalid.")}}),removeValidator:NGN.define(!0,!1,!1,function(e){this.validators.hasOwnProperty(e)&&(delete this.validators[e],this.emit("validator.remove",e))}),validate:NGN.define(!0,!1,!1,function(e){var i=!0;if(e&&this.validators.hasOwnProperty(e)){for(r=0;r<this.validators[e].length;r++)if(!t.validators[e][r](t[e]))return t.invalidDataAttributes.indexOf(e)<0&&t.invalidDataAttributes.push(e),!1;return!0}for(var a in this.validators)if(this[a]&&this.validators.hasOwnProperty(a)){for(var n=!0,r=0;r<this.validators[a].length&&(n=this.validators[a][r](this[a]),n);r++);!n&&this.invalidDataAttributes.indexOf(a)<0&&this.invalidDataAttributes.push(a),i&&!n&&(i=!1)}return!0}),valid:NGN._get(function(){return 0===this.invalidDataAttributes.length}),datafields:NGN._get(function(){return Object.keys(this.fields)}),getDataField:NGN.define(!0,!1,!1,function(e){return this.fields[e]}),hasDataField:NGN.define(!0,!1,!1,function(e){return this.fields.hasOwnProperty(e)}),data:NGN._get(function(){var e=this.serialize();return this.dataMap&&Object.keys(this.dataMap).forEach(function(i){e.hasOwnProperty(i)&&(e[t.dataMap[i]]=e[i],delete e[i])}),e}),serialize:NGN.define(!1,!1,!1,function(e){var t=e||this.raw,i={};for(var a in t)if(t.nonEnumerableProperties=t.nonEnumerableProperties||"",this.fields.hasOwnProperty(a)&&(a="id"===a?this.idAttribute:a,t.hasOwnProperty(a)&&t.nonEnumerableProperties.indexOf(a)<0&&/^[a-z0-9 ]$/.test(a.substr(0,1))||void 0!==t[a]&&t.enumerableProperties.indexOf(a)>=0)){var n=Object.getOwnPropertyDescriptor(t,a);if(!n.set)switch(typeof n.value){case"function":"Date"===n.value.name?i[a]=t[a].refs.toJSON():"RegExp"===n.value.name&&(i[a]=n.value());break;case"object":t[a]instanceof Array&&!Array.isArray(t[a])&&(t[a]=t[a].slice(0)),i[a]=t[a];break;default:i[a]=t[a]}}return i}),addField:NGN.define(!0,!1,!1,function(e,i){if(i=void 0!==i?i:!1,"id"!==e.toLowerCase()){if("object"==typeof e){if(!e.name)throw new Error("Cannot create data field. The supplied configuration does not contain a unique data field name.");var a=e;e=a.name,delete a.name}if(void 0!==t[e]&&(console.warn(e+" data field defined multiple times. Only the last defintion will be used."),delete t[e]),t.fields[e]=a||t.fields[e]||{},t.fields[e].required=NGN.coalesce(t.fields[e].required,!1),t.fields[e].type=NGN.coalesce(t.fields[e].type,String),t.fields[e]["default"]=NGN.coalesce(t.fields[e]["default"],null),t.raw[e]=t.fields[e]["default"],t[e]=t.raw[e],Object.defineProperty(t,e,{get:function(){return t.raw[e]},set:function(i){var a=t.raw[e];t.raw[e]=i;var n={action:"update",field:e,old:a,"new":t.raw[e]};this.changelog.push(n),this.emit("field.update",n),t.validate(e)||t.emit("field.invalid",{field:e})}}),!i){var n={action:"create",field:e};this.changelog.push(n),this.emit("field.create",n)}t.fields.hasOwnProperty(e)&&(t.fields[e].hasOwnProperty("pattern")&&t.addValidator(e,t.fields[e].pattern),["min","max","enum"].forEach(function(i){t.fields[e].hasOwnProperty(i)&&t.addValidator(e,function(a){return t._nativeValidators[i](t.fields[e],a)})}),t.fields[e].hasOwnProperty("required")&&t.fields[e].required&&t.addValidator(e,function(e){return t._nativeValidators.required(e)}),t.fields[e].hasOwnProperty("validate")&&("function"==typeof t.fields[e]?t.addValidator(e,function(i){return t.fields[e](i)}):console.warn("Invalid custom validation function. The value passed to the validate attribute must be a function.")))}}),addVirtual:NGN.define(!0,!1,!1,function(e,i){Object.defineProperty(this,e,NGN._get(function(){return i.apply(t)}))}),removeField:NGN.define(!0,!1,!1,function(e){if(this.raw.hasOwnProperty(e)){var t=this.raw[e];delete this[e],delete this.fields[e],delete this.raw[e],this.invalidDataAttributes.indexOf(e)>=0&&this.invalidDataAttributes.splice(this.invalidDataAttributes.indexOf(e),1);var i={action:"delete",field:e,value:t};this.emit("field.remove",i),this.changelog.push(i)}}),removeVirtual:NGN.define(!0,!1,!1,function(e){delete this[e]}),history:NGN._get(function(){return this.changelog.reverse()}),undo:NGN.define(!0,!1,!1,function(e){e=e||1;var i=this.changelog.splice(this.changelog.length-e,e);i.reverse().forEach(function(e){switch(e.action){case"update":t[e.field]=e.old;break;case"create":t.removeField(e.field);break;case"delete":t.addField(e.field),t[e.field]=t.old}})}),load:NGN.define(!0,!1,!1,function(e){e=e||{},null!==this._dataMap&&Object.keys(this.reverseMap).forEach(function(i){e.hasOwnProperty(i)&&(e[t.reverseMap[i]]=e[i],delete e[i])}),Object.keys(e).forEach(function(i){t.raw.hasOwnProperty(i)?t.raw[i]=e[i]:i===t.idAttribute?t.id=e[i]:console.warn(i+" was specified as a data field but is not defined in the model.")}),this.setUnmodified()})}),this.fields.hasOwnProperty("id")||(e.fields.id={required:!0,type:String,"default":e.id||null}),Object.keys(this.fields).forEach(function(e){t.addField(e,!0)}),Object.keys(this.virtuals).forEach(function(e){Object.defineProperty(t,e,NGN._get(function(){return t.virtuals[e].apply(t)}))})},window.NGN.DATA.Model=function(e){var t=function(t){this.constructor(e),t&&this.load(t)};return NGN.DATA.util.inherit(NGN.DATA.Entity,t),t},NGN.DATA.util.inherit(NGN.DATA.util.EventEmitter,NGN.DATA.Entity);